!function(){"use strict";var a=vAPI.messaging,b="",c=function(){var a=c,b=a.theNode;return void 0===b&&(b=a.theNode=uDom.nodeFromSelector("#whitelist textarea")),b},d=function(a){var b=d,c=b.theOffset||0;if(a!==c){var e=b.theNode;void 0===e&&(e=b.theNode=uDom.nodeFromSelector("#whitelist textarea + div")),e.style.right=a+"px",b.theOffset=a}},e=function(){var e,f,g,h=function(a){uDom.nodeFromId("whitelistApply").disabled=f||!a,uDom.nodeFromId("whitelistRevert").disabled=f,uDom.nodeFromId("whitelist").classList.toggle("invalid",!a)},i=function(){g=void 0,a.send("dashboard",{what:"validateWhitelistString",raw:e},h)};return function(){e=c().value.trim(),f=e===b,void 0!==g&&clearTimeout(g),g=vAPI.setTimeout(i,251);var a=c();d(a.offsetWidth-a.clientWidth)}}(),f=function(){var d=function(a){b=a.trim(),c().value=b+"\n",e()};a.send("dashboard",{what:"getWhitelist"},d)},g=function(){var a=function(){var a=c();a.value=[a.value.trim(),this.result.trim()].join("\n").trim(),e()},b=this.files[0];if(void 0!==b&&""!==b.name&&0===b.type.indexOf("text")){var d=new FileReader;d.onload=a,d.readAsText(b)}},h=function(){var a=document.getElementById("importFilePicker");a.value="",a.click()},i=function(){var a=c().value.trim();if(""!==a){var b=vAPI.i18n("whitelistExportFilename").replace("{{datetime}}",uBlockDashboard.dateNowToSensibleString()).replace(/ +/g,"_");vAPI.download({url:"data:text/plain;charset=utf-8,"+encodeURIComponent(a+"\n"),filename:b})}},j=function(){b=c().value.trim();var d={what:"setWhitelist",whitelist:b};a.send("dashboard",d,f)},k=function(){c().value=b+"\n",e()},l=function(){return c().value},m=function(a,b){if("string"==typeof a){var d=c();b&&(a=uBlockDashboard.mergeNewLines(d.value.trim(),a)),d.value=a.trim()+"\n",e()}};self.cloud.onPush=l,self.cloud.onPull=m,uDom("#importWhitelistFromFile").on("click",h),uDom("#importFilePicker").on("change",g),uDom("#exportWhitelistToFile").on("click",i),uDom("#whitelist textarea").on("input",e),uDom("#whitelistApply").on("click",j),uDom("#whitelistRevert").on("click",k),f()}();