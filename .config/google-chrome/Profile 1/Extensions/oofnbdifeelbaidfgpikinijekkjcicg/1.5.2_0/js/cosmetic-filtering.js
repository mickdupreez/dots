"use strict";µBlock.cosmeticFilteringEngine=function(){var a=µBlock,b=JSON.stringify,c=JSON.parse,d=function(){var a,b=document.createElement("div");return a=b.matches instanceof Function?b.matches.bind(b):b.mozMatchesSelector instanceof Function?b.mozMatchesSelector.bind(b):b.webkitMatchesSelector instanceof Function?b.webkitMatchesSelector.bind(b):b.msMatchesSelector instanceof Function?b.msMatchesSelector.bind(b):b.querySelector.bind(b),function(b){try{a(b+", "+b+":not(#foo)")}catch(c){return!1}return!0}}(),e=/^\/.+\/$/,f=function(a){try{void new RegExp(a)}catch(b){return f.message=b.toString(),!0}return!1},g=parseInt(vAPI.localStorage.getItem("cosmeticSurveyingMissCountMax"),10)||15,h=function(){};h.prototype.retrieve=function(a,b){b.push(a)},h.prototype.fid="#",h.prototype.toSelfie=function(){},h.fromSelfie=function(){return i};var i=new h,j=function(a){this.s=a};j.prototype.retrieve=function(a,b){b.push(this.s)},j.prototype.fid="#+",j.prototype.toSelfie=function(){return this.s},j.fromSelfie=function(a){return new j(a)};var k=function(a,b){this.s=a,this.hostname=b};k.prototype.retrieve=function(a,b){a.endsWith(this.hostname)&&b.push(this.s)},k.prototype.fid="h",k.prototype.toSelfie=function(){return b(this.s)+"	"+this.hostname},k.fromSelfie=function(a){var b=a.indexOf("	");return new k(c(a.slice(0,b)),a.slice(b+1))};var l=function(a,b){this.f=null,this.filters=[],void 0!==a&&(this.filters[0]=a,void 0!==b&&(this.filters[1]=b))};l.prototype.add=function(a){this.filters.push(a)},l.prototype.retrieve=function(a,b){for(var c=this.filters.length;c--;)this.filters[c].retrieve(a,b)},l.prototype.fid="[]",l.prototype.toSelfie=function(){return this.filters.length.toString()},l.fromSelfie=function(){return new l};var m=function(){this.prefix=this.suffix="",this.unhide=0,this.hostnames=[],this.invalid=!1,this.cosmetic=!0,this.reNeedHostname=/^(?:script:contains|script:inject|.+?:has|.+?:has-text|.+?:if|.+?:if-not|.+?:matches-css(?:-before|-after)?|.*?:xpath)\(.+\)$/};m.prototype.reset=function(){return this.raw="",this.prefix=this.suffix="",this.unhide=0,this.hostnames.length=0,this.invalid=!1,this.cosmetic=!0,this},m.prototype.parse=function(a){this.reset(),this.raw=a;var b=a.indexOf("#");if(-1===b)return this.cosmetic=!1,this;var c=a.indexOf("#",b+1);if(-1===c)return this.cosmetic=!1,this;if(c-b>3)return this.cosmetic=!1,this;64===a.charCodeAt(b+1)&&(this.unhide=1);var d=a.charCodeAt(c-1);if(35!==d&&64!==d){if(36!==d&&37!==d)return this.cosmetic=!1,this;if(36!==d)return this.invalid=!0,this;if(a=this.translateAdguardCSSInjectionFilter(a),""===a)return this.invalid=!0,this;c=a.indexOf("#",b+1)}return 0!==b&&(this.prefix=a.slice(0,b)),this.suffix=a.slice(c+1).trim(),0===this.suffix.length?(this.cosmetic=!1,this):-1!==this.suffix.indexOf("##")?(this.cosmetic=!1,this):(this.suffix.startsWith('[href^="',1)&&(this.suffix=this.suffix.slice(1)),""!==this.prefix&&(this.hostnames=this.prefix.split(/\s*,\s*/)),0===this.hostnames.length&&0===this.unhide&&this.reNeedHostname.test(this.suffix)?(this.invalid=!0,this):this)},m.prototype.translateAdguardCSSInjectionFilter=function(a){var b=/^([^#]*)#(@?)\$#([^{]+)\{([^}]+)\}$/.exec(a);return null===b?"":""===b[1]&&"@"!==b[2]?"":b[1]+"#"+b[2]+"#"+b[3].trim()+":style("+b[4].trim()+")"};var n=function(){this.reset()};n.junkyard=[],n.factory=function(){var a=n.junkyard.pop();return a?a.reset():new n};var o=20,p=30;n.prototype.reset=function(){return this.cosmetic={},this.cosmeticSurveyingMissCount=0,this.net={},this.netCount=0,this.lastAccessTime=Date.now(),this},n.prototype.dispose=function(){this.cosmetic=this.net=null,n.junkyard.length<25&&n.junkyard.push(this)},n.prototype.addCosmetic=function(a){var b=a.selectors,c=b.length||0;if(a.first&&0===c)return void((a.cost||0)>=80&&(this.cosmeticSurveyingMissCount+=1));this.cosmeticSurveyingMissCount=0;for(var d=this.cosmetic;c--;)d[b[c]]=!0},n.prototype.addNet=function(a){if("string"==typeof a?this.addNetOne(a,Date.now()):this.addNetMany(a,Date.now()),!(this.netCount<p))for(var b=this.net,c=Object.keys(b).sort(function(a,c){return b[c]-b[a]}).slice(o),d=c.length;d--;)delete b[c[d]]},n.prototype.addNetOne=function(a,b){var c=this.net;void 0===c[a]&&(this.netCount+=1),c[a]=b},n.prototype.addNetMany=function(a,b){for(var c,d=this.net,e=a.length||0;e--;)c=a[e],void 0===d[c]&&(this.netCount+=1),d[c]=b},n.prototype.add=function(a){this.lastAccessTime=Date.now(),"cosmetic"===a.type?this.addCosmetic(a):this.addNet(a.selectors)},n.prototype.remove=function(a){this.lastAccessTime=Date.now(),(void 0===a||"cosmetic"===a)&&(this.cosmetic={},this.cosmeticSurveyingMissCount=0),(void 0===a||"net"===a)&&(this.net={},this.netCount=0)},n.prototype.retrieve=function(a,b){this.lastAccessTime=Date.now();var c="cosmetic"===a?this.cosmetic:this.net;for(var d in c)c.hasOwnProperty(d)&&b.push(d)};var q=function(a){var b=a.length,c=b>>1,d=b>>2,e=b>>3,f=(2166136261^a.charCodeAt(0))>>>0;return f+=(f<<1)+(f<<4)+(f<<7)+(f<<8)+(f<<24),f>>>=0,f^=a.charCodeAt(e),f+=(f<<1)+(f<<4)+(f<<7)+(f<<8)+(f<<24),f>>>=0,f^=a.charCodeAt(d),f+=(f<<1)+(f<<4)+(f<<7)+(f<<8)+(f<<24),f>>>=0,f^=a.charCodeAt(d+e),f+=(f<<1)+(f<<4)+(f<<7)+(f<<8)+(f<<24),f>>>=0,f^=a.charCodeAt(c),f+=(f<<1)+(f<<4)+(f<<7)+(f<<8)+(f<<24),f>>>=0,f^=a.charCodeAt(c+e),f+=(f<<1)+(f<<4)+(f<<7)+(f<<8)+(f<<24),f>>>=0,f^=a.charCodeAt(c+d),f+=(f<<1)+(f<<4)+(f<<7)+(f<<8)+(f<<24),f>>>=0,f^=a.charCodeAt(b-1),f+=(f<<1)+(f<<4)+(f<<7)+(f<<8)+(f<<24),f>>>=0,f&=4095,f.toString(36)},r=function(){this.noDomainHash="-",this.parser=new m,this.selectorCachePruneDelay=6e5,this.selectorCacheAgeMax=72e5,this.selectorCacheCountMin=25,this.netSelectorCacheCountMax=p,this.selectorCacheTimer=null,this.reHasUnicode=/[^\x00-\x7F]/,this.rePlainSelector=/^[#.][\w\\-]+/,this.rePlainSelectorEscaped=/^[#.](?:\\[0-9A-Fa-f]+ |\\.|\w|-)+/,this.rePlainSelectorEx=/^[^#.\[(]+([#.][\w-]+)/,this.reEscapeSequence=/\\([0-9A-Fa-f]+ |.)/g,this.reHighLow=/^[a-z]*\[(?:alt|title)="[^"]+"\]$/,this.reHighMedium=/^\[href\^="https?:\/\/([^"]{8})[^"]*"\]$/,this.reScriptSelector=/^script:(contains|inject)\((.+)\)$/,this.punycode=punycode,this.reset()};return r.prototype.reset=function(){this.parser.reset(),this.µburi=a.URI,this.frozen=!1,this.acceptedCount=0,this.discardedCount=0,this.duplicateBuster=new Set,this.selectorCache={},this.selectorCacheCount=0,null!==this.selectorCacheTimer&&(clearTimeout(this.selectorCacheTimer),this.selectorCacheTimer=null),this.hasGenericHide=!1,this.lowGenericHide=new Set,this.lowGenericHideEx=new Map,this.lowGenericHideCount=0,this.highLowGenericHide={},this.highLowGenericHideCount=0,this.highMediumGenericHide={},this.highMediumGenericHideCount=0,this.highHighSimpleGenericHideArray=[],this.highHighSimpleGenericHide="",this.highHighSimpleGenericHideCount=0,this.highHighComplexGenericHideArray=[],this.highHighComplexGenericHide="",this.highHighComplexGenericHideCount=0,this.genericDonthide=[],this.specificFilters=new Map,this.scriptTagFilters={},this.scriptTagFilterCount=0,this.userScripts=new Map,this.userScriptCount=0},r.prototype.freeze=function(){this.duplicateBuster=new Set,""!==this.highHighSimpleGenericHide&&this.highHighSimpleGenericHideArray.unshift(this.highHighSimpleGenericHide),this.highHighSimpleGenericHide=this.highHighSimpleGenericHideArray.join(",\n"),this.highHighSimpleGenericHideArray=[],""!==this.highHighComplexGenericHide&&this.highHighComplexGenericHideArray.unshift(this.highHighComplexGenericHide),this.highHighComplexGenericHide=this.highHighComplexGenericHideArray.join(",\n"),this.highHighComplexGenericHideArray=[],this.hasGenericHide=0!==this.lowGenericHideCount||0!==this.highLowGenericHideCount||0!==this.highMediumGenericHideCount||0!==this.highHighSimpleGenericHideCount||0!==this.highHighComplexGenericHideCount,this.parser.reset(),this.frozen=!0},r.prototype.compileSelector=function(){var b=/^(.+?)(::?after|::?before)$/,c=/^(.+?):style\((.+?)\)$/,g=/url\([^)]+\)/,h=/^script:(contains|inject)\((.+)\)$/,i=document.createElement("div"),j=function(a){return g.test(a)?!1:(i.style.cssText=a,""===i.style.cssText?!1:(i.style.cssText="",!0))};return function(g){if(d(g)&&-1===g.indexOf("[-abp-properties="))return g;var i,k,l,m=g;if(null!==(i=c.exec(m))&&(m=i[1],l=i[2]),(i=b.exec(m))&&(m=i[1],k=i[2]),void 0!==l||void 0!==k){if(d(m)===!1)return;if(void 0!==k&&(m+=k),void 0!==l){if(j(l)===!1)return;return JSON.stringify({raw:g,style:[m,"{"+l+"}"]})}return JSON.stringify({raw:g,pseudoclass:!0})}if(null!==(i=h.exec(g))){if("inject"===i[1])return g;if(e.test(i[2])===!1||f(i[2].slice(1,-1))===!1)return g}var n;return(n=this.compileProceduralSelector(g))?n:void a.logger.writeOne("","error","Cosmetic filtering – invalid filter: "+g)}}(),r.prototype.compileProceduralSelector=function(){var a,b=/(:(?:has|has-text|if|if-not|matches-css|matches-css-after|matches-css-before|xpath))\(.+\)$/,c=/^\(*/,g=/\)*$/,h=/[.*+?^${}()|[\]\\]/g,i="",j=function(a){return d(a)?a:void 0},k=function(a){if(e.test(a)){if(a=a.slice(1,-1),f(a))return}else a=a.replace(h,"\\$&");return a},l=function(a){var b,c,d=a.indexOf(":");if(-1!==d){if(b=a.slice(0,d).trim(),c=a.slice(d+1).trim(),e.test(c)){if(c=c.slice(1,-1),f(c))return}else c=c.replace(h,"\\$&");return{name:b,value:c}}},m=function(a){return p(a)},n=function(a){var b;try{b=document.createExpression(a,null)instanceof XPathExpression}catch(c){return}return a},o=new Map([[":has",j],[":has-text",k],[":if",m],[":if-not",m],[":matches-css",l],[":matches-css-after",l],[":matches-css-before",l],[":xpath",n]]),p=function(a){var e=b.exec(a);if(null!==e){var f,h,i,j,k=[],l=a.slice(0,e.index),m=e[1],n=a.slice(e.index+m.length),p="",q=0;if(""===l||d(l)!==!1){for(;;){if(e=b.exec(n),null!==e?(f=n.slice(0,e.index),h=e[1]):(f=n,h=""),i=c.exec(f)[0].length,j=g.exec(f)[0].length,i>j?(0===q&&(p=""),q+=1):j>i&&q>0&&(q-=1,0===q&&(f=p+f)),0!==q)p+=f+h;else{if(p=o.get(m)(f.slice(1,-1)),void 0===p)return;k.push([m,p]),m=h}if(""===h)break;n=n.slice(e.index+h.length)}if(0!==k.length&&0===q)return{selector:l,tasks:k}}}else if(d(a))return{selector:a}};return function(b){if(b===i)return a;i=b;var c=p(b);return void 0!==c&&(c.raw=b,c=JSON.stringify(c)),a=c,c}}(),r.prototype.keyFromSelector=function(a){var b=this.rePlainSelector.exec(a);if(null!==b){var c=b[0];if(-1===c.indexOf("\\"))return c;if(c="",b=this.rePlainSelectorEscaped.exec(a),null!==b){var d=b[0],e=0;for(this.reEscapeSequence.lastIndex=0;;){if(b=this.reEscapeSequence.exec(d),null===b)return c+d.slice(e);c+=d.slice(e,b.index),e=this.reEscapeSequence.lastIndex,c+=1===b[1].length?b[1]:String.fromCharCode(parseInt(b[1],16))}}}},r.prototype.compile=function(a,b){var c=this.parser.parse(a);if(c.cosmetic===!1)return!1;if(c.invalid)return!0;var d=c.hostnames,e=d.length;if(0===e)return this.compileGenericSelector(c,b),!0;for(var f,g=!0;e--;)f=d[e],f.startsWith("~")===!1&&(g=!1),this.compileHostnameSelector(f,c,b);return g&&this.compileGenericSelector(c,b),!0},r.prototype.compileGenericSelector=function(a,b){0===a.unhide?this.compileGenericHideSelector(a,b):this.compileGenericUnhideSelector(a,b)},r.prototype.compileGenericHideSelector=function(a,b){var c,d,e=a.suffix,f=e.charAt(0);if("#"===f||"."===f){if(c=this.keyFromSelector(e),void 0===c)return;return c===e?void b.push("clg"+c):void(this.compileSelector(e)&&b.push("clg+"+c+""+e))}var g=this.compileSelector(e);if(void 0!==g)return this.reHighLow.test(e)?void b.push("chlg0"+e):(d=this.reHighMedium.exec(e),d&&2===d.length?void b.push("chmg0"+d[1]+""+e):this.reScriptSelector.test(e)?void b.push("cjs0"+e):(d=this.rePlainSelectorEx.exec(e),d&&2===d.length?void b.push("clg+"+d[1]+""+e):void(-1===e.indexOf(" ")?b.push("chhsg0"+e):b.push("chhcg0"+e))))},r.prototype.compileGenericUnhideSelector=function(a,b){var c=a.suffix;if(this.reScriptSelector.test(c))return void b.push("cjs1"+c);var d=this.compileSelector(c);void 0!==d&&b.push("cg1"+d)},r.prototype.compileHostnameSelector=function(a,b,c){var d=b.unhide;a.startsWith("~")&&(a=a.slice(1),d^=1),this.reHasUnicode.test(a)&&(a=this.punycode.toASCII(a));var e,f=b.suffix,g=this.µburi.domainFromHostname(a);if(this.reScriptSelector.test(f))return e=""!==g?g:this.noDomainHash,d&&(e="!"+e),void c.push("cjs"+e+""+a+""+f);var h=this.compileSelector(f);void 0!==h&&(e=a.endsWith(".*")===!1?""!==g?q(g):this.noDomainHash:q(a),d&&(e="!"+e),c.push("ch"+e+""+a+""+h))},r.prototype.fromCompiledContent=function(b,c,d){if(d)return void this.skipCompiledContent(b);if(c)return void this.skipGenericCompiledContent(b);for(var e,f,g,h,i,j,m,n=new a.FieldIterator("");b.eot()===!1;){if(e=b.next(),99!==e.charCodeAt(0))return void b.rewind();this.acceptedCount+=1,this.duplicateBuster.has(e)?this.discardedCount+=1:(this.duplicateBuster.add(e),n.first(e),f=n.next(),g=n.next(),"h"!==f?"lg"!==f?"lg+"!==f?"hlg0"!==f?"hmg0"!==f?"hhsg0"!==f?"hhcg0"!==f?"js"!==f?"g1"!==f?this.discardedCount+=1:this.genericDonthide.push(g):(h=n.next(),i=n.next(),this.createScriptFilter(g,h,i)):(this.highHighComplexGenericHideArray.push(g),this.highHighComplexGenericHideCount+=1):(this.highHighSimpleGenericHideArray.push(g),this.highHighSimpleGenericHideCount+=1):(h=n.next(),m=this.highMediumGenericHide[g],void 0===m?this.highMediumGenericHide[g]=h:Array.isArray(m)?m.push(h):this.highMediumGenericHide[g]=[m,h],this.highMediumGenericHideCount+=1):(this.highLowGenericHide[g]=!0,this.highLowGenericHideCount+=1):(h=n.next(),m=this.lowGenericHideEx.get(g),void 0===m?this.lowGenericHide.has(g)?this.lowGenericHideEx.set(g,[g,h]):(this.lowGenericHideEx.set(g,h),this.lowGenericHide.add(g)):Array.isArray(m)?m.push(h):this.lowGenericHideEx.set(g,[m,h]),this.lowGenericHideCount+=1):(m=this.lowGenericHideEx.get(g),void 0===m?this.lowGenericHide.add(g):Array.isArray(m)?m.push(g):this.lowGenericHideEx.set(g,[m,g]),this.lowGenericHideCount+=1):(h=n.next(),i=n.next(),j=new k(i,h),m=this.specificFilters.get(g),void 0===m?this.specificFilters.set(g,j):m instanceof l?m.add(j):this.specificFilters.set(g,new l(m,j))))}},r.prototype.skipGenericCompiledContent=function(b){for(var c,d,e,f,g,h,i,j=new a.FieldIterator("");b.eot()===!1;){if(c=b.next(),99!==c.charCodeAt(0))return void b.rewind();this.acceptedCount+=1,this.duplicateBuster.has(c)?this.discardedCount+=1:(j.first(c),d=j.next(),e=j.next(),"h"!==d?"js"!==d?"g1"!==d?this.discardedCount+=1:(this.duplicateBuster.add(c),this.genericDonthide.push(e)):(f=j.next(),g=j.next(),this.duplicateBuster.add(c),this.createScriptFilter(e,f,g)):(f=j.next(),g=j.next(),this.duplicateBuster.add(c),h=new k(g,f),i=this.specificFilters.get(e),void 0===i?this.specificFilters.set(e,h):i instanceof l?i.add(h):this.specificFilters.set(e,new l(i,h))))}},r.prototype.skipCompiledContent=function(b){for(var c,d,e,f,g,h=new a.FieldIterator("");b.eot()===!1;){if(c=b.next(),99!==c.charCodeAt(0))return void b.rewind();this.acceptedCount+=1,this.duplicateBuster.has(c)?this.discardedCount+=1:(h.first(c),d=h.next(),"js"!==d?this.discardedCount+=1:(this.duplicateBuster.add(c),e=h.next(),f=h.next(),g=h.next(),this.createScriptFilter(e,f,g)))}},r.prototype.createScriptFilter=function(a,b,c){return c.startsWith("script:contains")?this.createScriptTagFilter(a,b,c):c.startsWith("script:inject")?this.createUserScriptRule(a,b,c):void 0},r.prototype.createScriptTagFilter=function(a,b,c){var d=c.slice(16,-1);d=d.startsWith("/")&&d.endsWith("/")?d.slice(1,-1):d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),this.scriptTagFilters.hasOwnProperty(b)?this.scriptTagFilters[b]+="|"+d:this.scriptTagFilters[b]=d,this.scriptTagFilterCount+=1},r.prototype.retrieveScriptTagHostnames=function(){return Object.keys(this.scriptTagFilters)},r.prototype.retrieveScriptTagRegex=function(a,b){if(0!==this.scriptTagFilterCount){for(var c,d=[],e=b;(this.scriptTagFilters.hasOwnProperty(e)&&d.push(this.scriptTagFilters[e]),e!==a)&&(c=e.indexOf("."),-1!==c);)e=e.slice(c+1);return c=a.indexOf("."),-1!==c&&(e=a.slice(0,c)+".*",this.scriptTagFilters.hasOwnProperty(e)&&d.push(this.scriptTagFilters[e])),0!==d.length?d.join("|"):void 0}},r.prototype.createUserScriptRule=function(a,b,c){var d=new k(c,b),e=this.userScripts.get(a);void 0===e?this.userScripts.set(a,d):e instanceof l?e.add(d):this.userScripts.set(a,new l(e,d)),this.userScriptCount+=1},r.prototype.retrieveUserScripts=function(b,c){var d=a.redirectEngine;if(d){for(var e=[],f=new Map,g=b.indexOf("."),h=-1!==g?b.slice(0,g)+".*":"",i=c;(this._lookupUserScript(f,i+".js",d,e),i!==b)&&(g=i.indexOf("."),-1!==g);)i=i.slice(g+1);""!==h&&this._lookupUserScript(f,h+".js",d,e),this._lookupUserScript(f,d.resCache()+".js",d,e);var j,k=[];(j=this.userScripts.get(b))&&j.retrieve(c,k),""!==h&&(j=this.userScripts.get(h))&&j.retrieve(h,k);for(var l=k.length;l--;)this._lookupUserScript(f,k[l].slice(14,-1).trim(),d,e);if(e.push(),0!==e.length){var m,n,o=[];for((j=this.userScripts.get("!"+b))&&j.retrieve(c,o),""!==h&&(j=this.userScripts.get("!"+h))&&j.retrieve(c,o),l=o.length;l--;)n=o[l].slice(14,-1),void 0!==(m=f.get(n))&&(e[m]='// User script "'+n+'" excepted.\n');return e.join("\n")}}},r.prototype._lookupUserScript=function(a,b,c,d){if(!a.has(b)){var e,f,g=b.indexOf(",");-1===g?e=b:(e=b.slice(0,g).trim(),f=b.slice(g+1).trim());var h=c.resourceContentFromName(e,"application/javascript");h&&(!f||(h=this._fillupUserScript(h,f)))&&(a.set(b,d.length),d.push(h))}},r.prototype._fillupUserScript=function(a,b){for(var c,d,e=1;""!==b;)c=b.indexOf(","),-1===c&&(c=b.length),d=b.slice(0,c).trim().replace(this._reEscapeScriptArg,"\\$&"),a=a.replace("{{"+e+"}}",d),b=b.slice(c+1).trim(),e++;return a},r.prototype._reEscapeScriptArg=/[\\'"]/g,r.prototype.toSelfie=function(){var b=function(a){for(var b,c,d,e,f=[],g=a.entries();b=g.next(),!b.done;)if(f.push("k	"+b.value[0]),c=b.value[1],f.push(c.fid+"	"+c.toSelfie()),"[]"===c.fid){d=c.filters;for(var h=0,i=d.length;i>h;h++)e=d[h],f.push(e.fid+"	"+e.toSelfie())}return f.join("\n")};return{acceptedCount:this.acceptedCount,discardedCount:this.discardedCount,specificFilters:b(this.specificFilters),hasGenericHide:this.hasGenericHide,lowGenericHide:a.setToArray(this.lowGenericHide),lowGenericHideEx:a.mapToArray(this.lowGenericHideEx),lowGenericHideCount:this.lowGenericHideCount,highLowGenericHide:this.highLowGenericHide,highLowGenericHideCount:this.highLowGenericHideCount,highMediumGenericHide:this.highMediumGenericHide,highMediumGenericHideCount:this.highMediumGenericHideCount,highHighSimpleGenericHide:this.highHighSimpleGenericHide,highHighSimpleGenericHideCount:this.highHighSimpleGenericHideCount,highHighComplexGenericHide:this.highHighComplexGenericHide,highHighComplexGenericHideCount:this.highHighComplexGenericHideCount,genericDonthide:this.genericDonthide,scriptTagFilters:this.scriptTagFilters,scriptTagFilterCount:this.scriptTagFilterCount,userScripts:b(this.userScripts),userScriptCount:this.userScriptCount}},r.prototype.fromSelfie=function(b){var c={"[]":l,"#":h,"#+":j,h:k},d=function(a){for(var b,d,e,f,g,h,i=new Map,j=null,k=a,l=k.length,m=0;l>m;)d=k.indexOf("\n",m),0>d&&(d=l),e=k.slice(m,d),m=d+1,f=e.indexOf("	"),g=e.slice(0,f),"k"!==g?(h=c[g],null!==j?j.add(h.fromSelfie(e.slice(f+1))):(j=h.fromSelfie(e.slice(f+1)),i.set(b,j))):(b=e.slice(f+1),j=null);return i};this.acceptedCount=b.acceptedCount,this.discardedCount=b.discardedCount,this.specificFilters=d(b.specificFilters),this.hasGenericHide=b.hasGenericHide,this.lowGenericHide=a.setFromArray(b.lowGenericHide),this.lowGenericHideEx=a.mapFromArray(b.lowGenericHideEx),this.lowGenericHideCount=b.lowGenericHideCount,this.highLowGenericHide=b.highLowGenericHide,this.highLowGenericHideCount=b.highLowGenericHideCount,this.highMediumGenericHide=b.highMediumGenericHide,this.highMediumGenericHideCount=b.highMediumGenericHideCount,this.highHighSimpleGenericHide=b.highHighSimpleGenericHide,this.highHighSimpleGenericHideCount=b.highHighSimpleGenericHideCount,this.highHighComplexGenericHide=b.highHighComplexGenericHide,this.highHighComplexGenericHideCount=b.highHighComplexGenericHideCount,this.genericDonthide=b.genericDonthide,this.scriptTagFilters=b.scriptTagFilters,this.scriptTagFilterCount=b.scriptTagFilterCount,this.userScripts=d(b.userScripts),this.userScriptCount=b.userScriptCount,this.frozen=!0},r.prototype.triggerSelectorCachePruner=function(){null===this.selectorCacheTimer&&(this.selectorCacheCount<=this.selectorCacheCountMin||(this.selectorCacheTimer=vAPI.setTimeout(this.pruneSelectorCacheAsync.bind(this),this.selectorCachePruneDelay)))},r.prototype.addToSelectorCache=function(a){var b=a.hostname;if("string"==typeof b&&""!==b){var c=a.selectors;if(c){var d=this.selectorCache[b];void 0===d&&(d=this.selectorCache[b]=n.factory(),this.selectorCacheCount+=1,this.triggerSelectorCachePruner()),d.add(a)}}},r.prototype.removeFromSelectorCache=function(a,b){var c=a.length;for(var d in this.selectorCache)if(this.selectorCache.hasOwnProperty(d)!==!1){if("*"!==a){if(d.endsWith(a)===!1)continue;if(d.length!==c&&"."!==d.charAt(d.length-c-1))continue}this.selectorCache[d].remove(b)}},r.prototype.retrieveFromSelectorCache=function(a,b,c){var d=this.selectorCache[a];void 0!==d&&d.retrieve(b,c)},r.prototype.pruneSelectorCacheAsync=function(){if(this.selectorCacheTimer=null,!(this.selectorCacheCount<=this.selectorCacheCountMin)){for(var a,b,c=this.selectorCache,d=Object.keys(c).sort(function(a,b){return c[b].lastAccessTime-c[a].lastAccessTime}).slice(this.selectorCacheCountMin),e=Date.now()-this.selectorCacheAgeMax,f=d.length;f--&&(a=d[f],b=c[a],!(b.lastAccessTime>e));)b.dispose(),delete c[a],this.selectorCacheCount-=1;this.triggerSelectorCachePruner()}},r.prototype.retrieveGenericSelectors=function(a){if(0!==this.acceptedCount&&a.selectors){var b={hide:[]};a.firstSurvey&&(b.highGenerics={hideLow:this.highLowGenericHide,hideLowCount:this.highLowGenericHideCount,hideMedium:this.highMediumGenericHide,hideMediumCount:this.highMediumGenericHideCount,hideHighSimple:this.highHighSimpleGenericHide,hideHighSimpleCount:this.highHighSimpleGenericHideCount,hideHighComplex:this.highHighComplexGenericHide,hideHighComplexCount:this.highHighComplexGenericHideCount});for(var c,d,e=b.hide,f=a.selectors,g=f.length;g--;)c=f[g],this.lowGenericHide.has(c)!==!1&&((d=this.lowGenericHideEx.get(c))?Array.isArray(d)?e=e.concat(d):e.push(d):e.push(c));return b.hide=e,b}},r.prototype.retrieveDomainSelectors=function(a,b){if(a.locationURL){var c=this.µburi.hostnameFromURI(a.locationURL),d=this.µburi.domainFromHostname(c)||c,e=d.indexOf("."),f=-1===e?"":d.slice(0,e-d.length)+".*",h=this.selectorCache[c],i={ready:this.frozen,domain:d,entity:f,noDOMSurveying:this.hasGenericHide===!1,cosmeticHide:[],cosmeticDonthide:[],netHide:[],scripts:void 0};if(!b){var j,k;i.cosmeticDonthide=this.genericDonthide.slice(),j=q(d),(k=this.specificFilters.get(j))&&k.retrieve(c,i.cosmeticHide),(k=this.specificFilters.get("!"+j))&&k.retrieve(c,i.cosmeticDonthide),""!==f&&(j=q(f),(k=this.specificFilters.get(j))&&k.retrieve(f,i.cosmeticHide)),(k=this.specificFilters.get(this.noDomainHash))&&k.retrieve(c,i.cosmeticHide),(k=this.specificFilters.get("!"+this.noDomainHash))&&k.retrieve(c,i.cosmeticDonthide),h&&(h.retrieve("cosmetic",i.cosmeticHide),i.noDOMSurveying===!1&&(i.noDOMSurveying=h.cosmeticSurveyingMissCount>g))}return i.scripts=this.retrieveUserScripts(d,c),h&&h.retrieve("net",i.netHide),i}},r.prototype.getFilterCount=function(){return this.acceptedCount-this.discardedCount},new r}();