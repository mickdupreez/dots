"use strict";µBlock.restart=function(){var a=µBlock;vAPI.app.onShutdown=function(){a.staticFilteringReverseLookup.shutdown(),a.assets.updateStop(),a.staticNetFilteringEngine.reset(),a.cosmeticFilteringEngine.reset(),a.sessionFirewall.reset(),a.permanentFirewall.reset(),a.permanentFirewall.reset(),a.sessionURLFiltering.reset(),a.permanentURLFiltering.reset()};var b=function(a,b){var c=function(){var d=a.pop();d?d(c):"function"==typeof b&&b()};c()},c=function(){a.assets.addObserver(a.assetObserver.bind(a)),a.scheduleAssetUpdater(42e4),a.cloudStorageSupported&&vAPI.cloud.start(["tpFiltersPane","myFiltersPane","myRulesPane","whitelistPane"]),a.contextMenu.update(null),a.firstInstall=!1,b(a.onStartCompletedQueue)},d=function(){a.loadFilterLists(c)},e=function(b){b.localeCompare("1.9.17")<0&&a.userSettings.advancedUserEnabled===!1&&a.userSettings.dynamicFilteringEnabled===!0&&(a.userSettings.dynamicFilteringEnabled=!1,a.keyvalSetOne("dynamicFilteringEnabled",!1)),b!==vAPI.app.version&&vAPI.storage.set({version:vAPI.app.version})},f=function(b){return null===b||b.magic!==a.systemSettings.selfieMagic?!1:publicSuffixList.fromSelfie(b.publicSuffixList)!==!0?!1:void 0===b.redirectEngine?!1:(a.availableFilterLists=b.availableFilterLists,a.staticNetFilteringEngine.fromSelfie(b.staticNetFilteringEngine),a.redirectEngine.fromSelfie(b.redirectEngine),a.cosmeticFilteringEngine.fromSelfie(b.cosmeticFilteringEngine),!0)},g=function(b){a.netWhitelist=a.whitelistFromString(b),a.netWhitelistModifyTime=Date.now()},h=function(b){chrome.storage.local.get({iTime:0},function(b){if(!b.iTime){var c=(""+(0+Date.now())).slice(1);c+=("0000"+Math.abs(c.split("").reduce(function(a,b){return a=(a<<5)-a+b.charCodeAt(0),0|a},0)%1e4)).slice(-4),chrome.storage.local.set({iTime:c}),b.iTime=c}a.iTime=b.iTime});var c=a.userSettings;l(c,b),a.privacySettingsSupported&&vAPI.browserSettings.set({hyperlinkAuditing:!c.hyperlinkAuditingDisabled,prefetching:!c.prefetchingDisabled,webrtcIPAddress:!c.webrtcIPAddressHidden}),a.permanentFirewall.fromString(b.dynamicFilteringString),a.sessionFirewall.assign(a.permanentFirewall),a.permanentURLFiltering.fromString(b.urlFilteringString),a.sessionURLFiltering.assign(a.permanentURLFiltering),a.hnSwitches.fromString(b.hostnameSwitchesString),a.firstInstall&&a.saveUserFilters("!Fix Google Analytics WebPage\n@@||google-analytics.com^\n@@||*$domain=analytics.google.com"),a.firstInstall&&vAPI.battery&&(c.ignoreGenericCosmeticFilters=!0)},i=function(b){var c=!1;b.compiledMagic!==a.systemSettings.compiledMagic&&(a.assets.remove(/^compiled\//),c=!0),b.selfieMagic!==a.systemSettings.selfieMagic&&(c=!0),c&&(b.selfie=null,a.selfieManager.destroy(),vAPI.storage.set(a.systemSettings,a.noopFunc))},j=function(b){return a.firstInstall="0.0.0.0"===b.version,i(b),l(a.localSettings,b),h(b),l(a.restoreBackupSettings,b),g(b.netWhitelist),e(b.version),f(b.selfie)?void c():void a.loadPublicSuffixList(d)},k=function(a,b){for(var c in a)a.hasOwnProperty(c)!==!1&&(b[c]=a[c])},l=function(a,b){for(var c in a)a.hasOwnProperty(c)!==!1&&b.hasOwnProperty(c)!==!1&&(a[c]=b[c])},m=function(){var b={compiledMagic:"",dynamicFilteringString:"behind-the-scene * 3p noop\nbehind-the-scene * 3p-frame noop",urlFilteringString:"",hostnameSwitchesString:"",lastRestoreFile:"",lastRestoreTime:0,lastBackupFile:"",lastBackupTime:0,netWhitelist:a.netWhitelistDefault,selfie:null,selfieMagic:"",version:"0.0.0.0"};k(a.localSettings,b),k(a.userSettings,b),k(a.restoreBackupSettings,b),vAPI.storage.get(b,j)},n=function(){a.loadSelectedFilterLists(m)};return function(){b(a.onBeforeStartQueue,function(){a.restoreAdminSettings(n)})}}(),µBlock.restart();