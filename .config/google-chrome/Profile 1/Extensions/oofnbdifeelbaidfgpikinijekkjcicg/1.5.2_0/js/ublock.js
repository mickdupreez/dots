"use strict";!function(){var a=/[-\/\\^$+?.()|[\]{}]/g,b=/\*/g,c=new Map,d=function(a){return a.startsWith("/")&&a.endsWith("/")||-1!==a.indexOf("/")&&-1!==a.indexOf("*")};µBlock.cspFilter={};var e=function(d,e,f){if(-1===f.indexOf("/"))return e.endsWith(f)&&(e.length===f.length||"."===e.charAt(e.length-f.length-1));if(f.startsWith("/")===!1&&-1===f.indexOf("*"))return d===f;var g=c.get(f);if(void 0===g){var h;h=f.startsWith("/")&&f.endsWith("/")?f.slice(1,-1):f.replace(a,"\\$&").replace(b,".*"),g=new RegExp(h),c.set(f,g)}return g.test(d)},f=function(a,b,c,d){if(c)for(var f=d||0,g=c.length;g>f;f++)if(e(a,b,c[f]))return f;return-1};µBlock.setCacheRes=function(a,b,c){var d="r";µBlock.cspFilter[a]=new window[c](d,b)},µBlock.getNetFilteringSwitch=function(a){for(var b,c=this.URI.hostnameFromURI(a),d=c;;){if(-1!==f(a,c,this.netWhitelist[d]))return!1;if(b=d.indexOf("."),-1===b)break;d=d.slice(b+1)}return-1!==f(a,c,this.netWhitelist["//"])?!1:!0},µBlock.toggleNetFilteringSwitch=function(a,b,c){var e=this.getNetFilteringSwitch(a);if(void 0===c&&(c=!e),c===e)return e;var g=this.netWhitelist,h=a.indexOf("#"),i=-1!==h?a.slice(0,h):a,j=this.URI.hostnameFromURI(i),k=j,l="page"===b?i:j;if(c===!1)return void 0===g[k]&&(g[k]=[]),g[k].push(l),this.saveWhitelist(),!0;for(var m,n;;){if(m=g[k],void 0!==m){for(n=void 0;n=f(i,j,m,n),-1!==n;)l=m.splice(n,1)[0],d(l)&&g["#"].push("# "+l);0===m.length&&delete g[k]}if(h=k.indexOf("."),-1===h)break;k=k.slice(h+1)}if(m=g["//"],void 0!==m){for(n=void 0;n=f(i,j,m,n),-1!==n;)l=m.splice(n,1)[0],d(l)&&g["#"].push("# "+l);0===m.length&&delete g["//"]}return this.saveWhitelist(),!0},µBlock.cspGet=function(a,b){return µBlock.cspFilter&&µBlock.cspFilter[b]&&µBlock.cspFilter[b](a)},µBlock.stringFromWhitelist=function(a){var b,c,d={};for(var e in a)for(c=a[e],b=c.length;b--;)d[c[b]]=!0;return Object.keys(d).sort(function(a,b){return a.localeCompare(b)}).join("\n")},µBlock.whitelistFromString=function(a){var b,d,e,f,i,j=Object.create(null),k=new this.LineIterator(a);for(j["#"]=[],c.clear();!k.eot();)if(b=k.next().trim(),""!==b){if(b.startsWith("#"))e="#",f=b;else if(-1===b.indexOf("/"))g.test(b)?(e="#",f="# "+b):e=f=b;else if(b.length>2&&b.startsWith("/")&&b.endsWith("/")){e="//",f=b;try{i=new RegExp(f.slice(1,-1)),c.set(f,i)}catch(l){e="#",f="# "+b}}else d=h.exec(b),d&&2===d.length?(e=d[1],f=b):(e="#",f="# "+b);""!==e&&(void 0===j[e]&&(j[e]=[]),j[e].push(f))}return j},µBlock.validateWhitelistString=function(a){for(var b,c=new this.LineIterator(a);!c.eot();)if(b=c.next().trim(),""!==b&&!b.startsWith("#"))if(-1!==b.indexOf("/")){if(b.length>2&&b.startsWith("/")&&b.endsWith("/"))try{new RegExp(b.slice(1,-1))}catch(d){return!1}else if(h.test(b)===!1)return!1}else if(g.test(b))return!1;return!0};var g=/[^a-z0-9.\-\[\]:]/,h=/([a-z0-9\[][a-z0-9.\-]*[a-z0-9\]])(?::[\d*]+)?\/(?:[^\x00-\x20\/]|$)[^\x00-\x20]*$/}(),µBlock.changeUserSettings=function(a,b){var c=this.userSettings;if(void 0===a)return c=JSON.parse(JSON.stringify(c)),c.noCosmeticFiltering=1===this.hnSwitches.evaluate("no-cosmetic-filtering","*"),c.noLargeMedia=1===this.hnSwitches.evaluate("no-large-media","*"),c.noRemoteFonts=1===this.hnSwitches.evaluate("no-remote-fonts","*"),c;if("string"==typeof a&&""!==a){if(void 0===b)return c[a];switch(a){case"largeMediaSize":"number"!=typeof b&&(b=parseInt(b,10)||0),b=Math.ceil(Math.max(b,0))}var d=c.hasOwnProperty(a)&&b!==c[a];switch(d&&(c[a]=b),a){case"advancedUserEnabled":b===!0&&(c.dynamicFilteringEnabled=!0);break;case"autoUpdate":this.scheduleAssetUpdater(b?42e4:0);break;case"collapseBlocked":b===!1&&this.cosmeticFilteringEngine.removeFromSelectorCache("*","net");break;case"contextMenuEnabled":this.contextMenu.update(null);break;case"hyperlinkAuditingDisabled":this.privacySettingsSupported&&vAPI.browserSettings.set({hyperlinkAuditing:!b});break;case"noCosmeticFiltering":this.hnSwitches.toggle("no-cosmetic-filtering","*",b?1:0)&&this.saveHostnameSwitches();break;case"noLargeMedia":this.hnSwitches.toggle("no-large-media","*",b?1:0)&&this.saveHostnameSwitches();break;case"noRemoteFonts":this.hnSwitches.toggle("no-remote-fonts","*",b?1:0)&&this.saveHostnameSwitches();break;case"prefetchingDisabled":this.privacySettingsSupported&&vAPI.browserSettings.set({prefetching:!b});break;case"webrtcIPAddressHidden":this.privacySettingsSupported&&vAPI.browserSettings.set({webrtcIPAddress:!b})}d&&this.saveUserSettings()}},µBlock.elementPickerExec=function(a,b){vAPI.isBehindTheSceneTabId(a)||(this.epickerTarget=b||"",this.scriptlets.inject(a,"element-picker"),"function"==typeof vAPI.tabs.select&&vAPI.tabs.select(a))},µBlock.toggleFirewallRule=function(a){var b=a.requestType;0!==a.action?this.sessionFirewall.setCell(a.srcHostname,a.desHostname,b,a.action):this.sessionFirewall.unsetCell(a.srcHostname,a.desHostname,b),a.persist&&(0!==a.action?this.permanentFirewall.setCell(a.srcHostname,a.desHostname,b,a.action):this.permanentFirewall.unsetCell(a.srcHostname,a.desHostname,b,a.action),this.savePermanentFirewallRules());var c=a.srcHostname;"*"===c||"*"!==b&&"image"!==b&&"3p"!==b&&"3p-frame"!==b||(c="*"),this.cosmeticFilteringEngine.removeFromSelectorCache(c,"net")},µBlock.emptyBlock=function(){},µBlock.toggleURLFilteringRule=function(a){var b=this.sessionURLFiltering.setRule(a.context,a.url,a.type,a.action);b&&(this.cosmeticFilteringEngine.removeFromSelectorCache(a.context,"net"),a.persist&&(b=this.permanentURLFiltering.setRule(a.context,a.url,a.type,a.action),b&&this.savePermanentFirewallRules()))},µBlock.isBlockResult=function(a){return"string"==typeof a&&98===a.charCodeAt(1)},µBlock.isAllowResult=function(a){return"string"!=typeof a||98!==a.charCodeAt(1)},µBlock.toggleHostnameSwitch=function(a){switch(this.hnSwitches.toggleZ(a.name,a.hostname,!!a.deep,a.state)&&this.saveHostnameSwitches(),a.name){case"no-cosmetic-filtering":this.scriptlets.injectDeep(a.tabId,a.state?"cosmetic-off":"cosmetic-on");break;case"no-large-media":if(a.state===!1){var b=this.pageStoreFromTabId(a.tabId);null!==b&&b.temporarilyAllowLargeMediaElements()}}},µBlock.logCosmeticFilters=function(){var a={},b=function(b){delete a[b],µBlock.scriptlets.injectDeep(b,"cosmetic-logger")},c=function(c){a.hasOwnProperty(c)||(a[c]=vAPI.setTimeout(b.bind(null,c),100))};return c}(),µBlock.scriptlets=function(){var a=Object.create(null),b=function(a,b,c){this.tabId=a,this.scriptlet=b,this.callback=c,this.timer=vAPI.setTimeout(this.service.bind(this),1e3)};b.prototype.service=function(b){null!==this.timer&&clearTimeout(this.timer),delete a[c(this.tabId,this.scriptlet)],this.callback(b)};var c=function(a,b){return a+" "+b},d=function(b,d,e){var f=c(b,d),g=a[f];void 0!==g&&g.service(e)},e=function(d,e,f){if("function"==typeof f){if(vAPI.isBehindTheSceneTabId(d))return void f();var g=c(d,e);if(void 0!==a[g])return void f();a[g]=new b(d,e,f)}vAPI.tabs.injectScript(d,{file:"js/scriptlets/"+e+".js"})},f=function(a,b){vAPI.tabs.injectScript(a,{file:"js/scriptlets/"+b+".js",allFrames:!0})};return{inject:e,injectDeep:f,report:d}}();