"use strict";!function(){var a={},b="",c=vAPI.i18n("3pLastUpdate"),d=/[a-z-]+:\/\/\S*\/\S+/,e=function(a){switch(a.what){case"assetUpdated":j(a);break;case"assetsUpdated":document.body.classList.remove("updating");break;case"staticFilteringDataChanged":h()}},f=vAPI.messaging;f.addChannelListener("dashboard",e);var g=function(a){return a.toLocaleString()},h=function(d){var e=uDom("#templates .groupEntry"),h=uDom("#templates .listEntry"),j=vAPI.i18n("3pListsOfBlockedHostsPerListStats"),l=vAPI.i18n.renderElapsedTimeToString,m=document.body.classList.contains("hideUnused"),n=function(b){var c=a.current[b]||a.available[b],d=c?c.title:"";return""===d?b:d},o=function(b,e){var f,i=a.available[b];e||(e=h.clone().nodeAt(0)),e.getAttribute("data-listkey")!==b&&(e.setAttribute("data-listkey",b),f=e.querySelector('input[type="checkbox"]'),f.checked=i.off!==!0,f=e.querySelector("a:nth-of-type(1)"),f.setAttribute("href","asset-viewer.html?url="+encodeURI(b)),f.setAttribute("type","text/html"),f.textContent=n(b),e.classList.remove("toRemove"),i.supportName?(e.classList.add("support"),f=e.querySelector("a.support"),f.setAttribute("href",i.supportURL),f.setAttribute("title",i.supportName)):e.classList.remove("support"),i.external?e.classList.add("external"):e.classList.remove("external"),i.instructionURL?(e.classList.add("mustread"),f=e.querySelector("a.mustread"),f.setAttribute("href",i.instructionURL)):e.classList.remove("mustread")),d||(f=e.querySelector('input[type="checkbox"]'),f.checked=i.off!==!0),e.style.setProperty("display",m&&i.off===!0?"none":""),f=e.querySelector("span.counts");var k="";isNaN(+i.entryUsedCount)||isNaN(+i.entryCount)||(k=j.replace("{{used}}",g(i.off?0:i.entryUsedCount)).replace("{{total}}",g(i.entryCount))),f.textContent=k;var o=a.cache[b]||{},p=o.remoteURL;return e.classList.toggle("unsecure","string"==typeof p&&0===p.lastIndexOf("http:",0)),e.classList.toggle("failed",void 0!==o.error),e.classList.toggle("obsolete",o.obsolete===!0),e.classList.toggle("cached",o.cached===!0&&o.writeTime>0),o.cached&&e.querySelector(".status.cache").setAttribute("title",c.replace("{{ago}}",l(o.writeTime))),e.classList.remove("discard"),e},p=function(b){if(Array.isArray(b)===!1)return"";for(var c=0,d=b.length;d--;)a.available[b[d]].off!==!0&&(c+=1);return 0===c?"":"("+c.toLocaleString()+")"},q=function(b,c){var d=document.querySelector('#lists > .groupEntry[data-groupkey="'+b+'"]');if(null===d){d=e.clone().nodeAt(0);var f=vAPI.i18n("3pGroup"+b.charAt(0).toUpperCase()+b.slice(1));""!==f&&(d.querySelector(".geName").textContent=f)}null===d.querySelector(".geName:empty")&&(d.querySelector(".geCount").textContent=p(c));var g=d.querySelector(".listEntries");if(!c)return d;c.sort(function(b,c){return(a.available[b].title||"").localeCompare(a.available[c].title||"")});for(var h=0;h<c.length;h++){var i=o(c[h],g.children[h]);null===i.parentElement&&g.appendChild(i)}return d},r=function(a){for(var b,c,d,e={},f=Object.keys(a),g=f.length;g--;)b=f[g],c=a[b],d=c.group||"nogroup",void 0===e[d]&&(e[d]=[]),e[d].push(b);return e},s=function(c){a=c,uDom("#lists .listEntries .listEntry").addClass("discard");var e,f,h,j=document.querySelector("#lists"),l=r(c.available),m=["default","ads","privacy","malware","social","multipurpose","regions","custom"];for(f=0;f<m.length;f++)h=m[f],e=q(h,l[h]),e.setAttribute("data-groupkey",h),e.classList.toggle("collapsed","y"===vAPI.localStorage.getItem("collapseGroup"+(f+1))),null===e.parentElement&&j.appendChild(e),delete l[h];for(m=Object.keys(l),f=0;f<m.length;f++)h=m[f],j.appendChild(q(h,l[h]));uDom("#lists .listEntries .listEntry.discard").remove(),uDom("#autoUpdate").prop("checked",a.autoUpdate===!0),uDom("#listsOfBlockedHostsPrompt").text(vAPI.i18n("3pListsOfBlockedHostsPrompt").replace("{{netFilterCount}}",g(c.netFilterCount)).replace("{{cosmeticFilterCount}}",g(c.cosmeticFilterCount))),uDom("#parseCosmeticFilters").prop("checked",a.parseCosmeticFilters===!0),uDom("#ignoreGenericCosmeticFilters").prop("checked",a.ignoreGenericCosmeticFilters===!0),d||(b=k()),i()};f.send("dashboard",{what:"getLists"},s)},i=function(){uDom("#buttonApply").toggleClass("disabled",b===k()),uDom("#buttonPurgeAll").toggleClass("disabled",null===document.querySelector("#lists .listEntry.cached")),uDom("#buttonUpdate").toggleClass("disabled",null===document.querySelector('body:not(.updating) #lists .listEntry.obsolete > input[type="checkbox"]:checked'))},j=function(a){var b=document.querySelector('#lists .listEntry[data-listkey="'+a.key+'"]');null!==b&&(b.classList.toggle("failed",!!a.failed),b.classList.toggle("obsolete",!a.cached),b.classList.toggle("cached",!!a.cached),a.cached&&b.querySelector(".status.cache").setAttribute("title",c.replace("{{ago}}",vAPI.i18n.renderElapsedTimeToString(Date.now()))),i())},k=function(){for(var a,b=[document.getElementById("parseCosmeticFilters").checked,document.getElementById("ignoreGenericCosmeticFilters").checked],c=[],e=document.querySelectorAll("#lists .listEntry[data-listkey]:not(.toRemove)"),f=e.length;f--;)a=e[f],null!==a.querySelector('input[type="checkbox"]:checked')&&c.push(a.getAttribute("data-listkey"));return b.push(c.sort().join(),d.test(document.getElementById("externalLists").value),null!==document.querySelector("#lists .listEntry.toRemove")),b.join()},l=function(){i()},m=function(a){var b=uDom(this).ancestors("[data-listkey]"),c=b.attr("data-listkey");c&&(b.toggleClass("toRemove"),i()),a.preventDefault()},n=function(){var a=uDom(this),b=a.ancestors("[data-listkey]"),c=b.attr("data-listkey");c&&(f.send("dashboard",{what:"purgeCache",assetKey:c}),b.addClass("obsolete"),b.removeClass("cached"),b.descendants("input").first().prop("checked")&&i())},o=function(a){f.send("dashboard",{what:"userSettings",name:"parseAllABPHideFilters",value:document.getElementById("parseCosmeticFilters").checked}),f.send("dashboard",{what:"userSettings",name:"ignoreGenericCosmeticFilters",value:document.getElementById("ignoreGenericCosmeticFilters").checked});for(var c,d=[],e=document.querySelectorAll("#lists .listEntry[data-listkey]:not(.toRemove)"),g=e.length;g--;)c=e[g],null!==c.querySelector('input[type="checkbox"]:checked')&&d.push(c.getAttribute("data-listkey"));var h=[];for(e=document.querySelectorAll("#lists .listEntry.toRemove[data-listkey]"),g=e.length;g--;)h.push(e[g].getAttribute("data-listkey"));var i=document.getElementById("externalLists"),j=i.value.trim();i.value="",f.send("dashboard",{what:"applyFilterListSelection",toSelect:d,toImport:j,toRemove:h},a),b=k()},p=function(){uDom("#buttonApply").removeClass("enabled");var a=function(){f.send("dashboard",{what:"reloadAllFilters"})};o(a),i()},q=function(){var a=function(){document.body.classList.add("updating"),f.send("dashboard",{what:"forceUpdateAssets"}),i()};o(a),i()},r=function(a){uDom("#buttonPurgeAll").removeClass("enabled"),f.send("dashboard",{what:"purgeAllCaches",hard:a.ctrlKey&&a.shiftKey},function(){h(!0)})},s=function(){f.send("dashboard",{what:"userSettings",name:"autoUpdate",value:this.checked})},t=function(){document.body.classList.toggle("hideUnused");var a=document.body.classList.contains("hideUnused");uDom('#lists li.listEntry > input[type="checkbox"]:not(:checked)').ancestors("li.listEntry[data-listkey]").css("display",a?"none":""),vAPI.localStorage.setItem("hideUnusedFilterLists",a?"1":"0")},u=function(){var a=uDom(this).ancestors(".groupEntry");a.toggleClass("collapsed");var b="collapseGroup"+a.nthOfType();a.hasClass("collapsed")?vAPI.localStorage.setItem(b,"y"):vAPI.localStorage.removeItem(b)},v=function(){for(var b,c={parseCosmeticFilters:uDom.nodeFromId("parseCosmeticFilters").checked,ignoreGenericCosmeticFilters:uDom.nodeFromId("ignoreGenericCosmeticFilters").checked,selectedLists:[],externalLists:a.externalLists},d=uDom("#lists .listEntry"),e=d.length;e--;)b=d.at(e),b.descendants("input").prop("checked")&&c.selectedLists.push(b.attr("data-listkey"));return c},w=function(b,c){if("object"==typeof b&&null!==b){var d,e,f,g;d=uDom.nodeFromId("parseCosmeticFilters"),e=b.parseCosmeticFilters===!0||c&&d.checked,d.checked=a.parseCosmeticFilters=e,d=uDom.nodeFromId("ignoreGenericCosmeticFilters"),e=b.ignoreGenericCosmeticFilters===!0||c&&d.checked,d.checked=a.ignoreGenericCosmeticFilters=e;var h;for(f=0,g=b.selectedLists.length;g>f;f++)h=b.selectedLists[f],a.aliases[h]&&(b.selectedLists[f]=a.aliases[h]);var j,k,l=new Set(b.selectedLists),m=uDom("#lists .listEntry");for(f=0,g=m.length;g>f;f++)j=m.at(f),h=j.attr("data-listkey"),k=j.descendants("input").first(),c&&k.prop("checked")||k.prop("checked",l.has(h));d=uDom.nodeFromId("externalLists"),c||(d.value=""),d.value+=b.externalLists||"",i()}};self.cloud.onPush=v,self.cloud.onPull=w,document.body.classList.toggle("hideUnused","1"===vAPI.localStorage.getItem("hideUnusedFilterLists")),uDom("#autoUpdate").on("change",s),uDom("#parseCosmeticFilters").on("change",l),uDom("#ignoreGenericCosmeticFilters").on("change",l),uDom("#buttonApply").on("click",p),uDom("#buttonUpdate").on("click",q),uDom("#buttonPurgeAll").on("click",r),uDom("#listsOfBlockedHostsPrompt").on("click",t),uDom("#lists").on("click",".groupEntry > span",u),uDom("#lists").on("change",".listEntry > input",l),uDom("#lists").on("click",".listEntry > a.remove",m),uDom("#lists").on("click","span.cache",n),uDom("#externalLists").on("input",l),h()}();