"use strict";µBlock.staticNetFilteringEngine=function(){var a=µBlock,b=0,c=1,d=2,e=0,f=4,g=8,h=0,i={no_type:0,stylesheet:16,image:32,object:48,script:64,xmlhttprequest:80,sub_frame:96,font:112,media:128,websocket:144,other:160,popunder:176,main_frame:192,generichide:208,"inline-script":224,popup:240},j=i.other,k={1:"stylesheet",2:"image",3:"object",4:"script",5:"xmlhttprequest",6:"subdocument",7:"font",8:"media",9:"websocket",10:"other",11:"popunder",12:"document",13:"generichide",14:"inline-script",15:"popup"},l=(1<<(j>>>4))-1,m=b|h|e,n=b|h,o=b|e,p=c|h|e,q=c|h,r=c|e,s=c|e|i.generichide,t=b|e|i.generichide|d,u="",v="",w=function(){},x=parseInt,y=function(a){return x(a,10)},z=function(a,b){return b.endsWith(a)&&(b.length===a.length||"."===b.charAt(b.length-a.length-1))},A=function(a){try{var b=new RegExp(a);return b.source}catch(c){A.message=c.toString()}return""},B={match:{0:"",index:0},exec:function(a){return this.match[0]=a,this.match},test:function(){return!0}},C=function(a,b,c){if("*"===a)return B;var d;a.startsWith("||")&&(a=a.slice(2),d=42===a.charCodeAt(0));var e=a.replace(/[.+?${}()|[\]\\]/g,"\\$&").replace(/\^/g,"(?:[^%.0-9a-z_-]|$)").replace(/^\*|\*$/g,"").replace(/\*/g,"[^ ]*?");return 0>b?e="^"+e:b>0&&(e+="$"),d&&(e="[0-9a-z.-]*?"+e),new RegExp(e,c)},D=function(a){return a.toString(16)},E=function(a,b){var c=a.indexOf("://");return-1===c?!1:(c+=3,c>=b?!0:F.test(a.slice(c,b))?!1:46===a.charCodeAt(b-1))},F=/[\/?#]/,G=function(a){var b=G;return a===b.domainOpt?b.hnMatcher:(b.domainOpt=a,-1===a.indexOf("|")?126===a.charCodeAt(0)?b.hnMatcher=new b.Miss(a):b.hnMatcher=new b.Hit(a):-1===a.indexOf("~")?b.hnMatcher=new b.HitSet(a):b.reAllNegated.test(a)?b.hnMatcher=new b.MissSet(a):b.hnMatcher=new b.MixedSet(a))};G.reAllNegated=/^~(?:[^|~]+\|~)+[^|~]+$/,G.domainOpt=void 0,G.hnMatcher=void 0,G.Hit=function(a){this.hostname=a},G.Hit.prototype.toDomainOpt=function(){return this.hostname},G.Hit.prototype.test=function(){var a=this.hostname,b=u;return b.endsWith(a)&&(b.length===a.length||46===b.charCodeAt(b.length-a.length-1))},G.Miss=function(a){this.hostname=a.slice(1)},G.Miss.prototype.toDomainOpt=function(){return"~"+this.hostname},G.Miss.prototype.test=function(){var a=this.hostname,b=u;return b.endsWith(a)===!1||b.length!==a.length&&46!==b.charCodeAt(b.length-a.length-1)},G.HitSet=function(a){this.domainOpt=a},G.HitSet.prototype.oneOf=null,G.HitSet.prototype.toDomainOpt=function(){return this.domainOpt},G.HitSet.prototype.init=function(){this.oneOf=new RegExp("(?:^|\\.)(?:"+this.domainOpt.replace(/\./g,"\\.")+")$")},G.HitSet.prototype.test=function(){return null===this.oneOf&&this.init(),this.oneOf.test(u)},G.MissSet=function(a){this.domainOpt=a},G.MissSet.prototype.noneOf=null,G.MissSet.prototype.toDomainOpt=function(){return this.domainOpt},G.MissSet.prototype.init=function(){this.noneOf=new RegExp("(?:^|\\.)(?:"+this.domainOpt.replace(/~/g,"").replace(/\./g,"\\.")+")$")},G.MissSet.prototype.test=function(){return null===this.noneOf&&this.init(),this.noneOf.test(u)===!1},G.MixedSet=function(a){this.domainOpt=a},G.MixedSet.prototype.oneOf=null,G.MixedSet.prototype.noneOf=null,G.MixedSet.prototype.toDomainOpt=function(){return this.domainOpt},G.MixedSet.prototype.init=function(){for(var a,b=[],c=[],d=this.domainOpt.split("|"),e=d.length;e--;)a=d[e].replace(/\./g,"\\."),126===a.charCodeAt(0)?c.push(a.slice(1)):b.push(a);this.oneOf=new RegExp("(?:^|\\.)(?:"+b.join("|")+")$"),this.noneOf=new RegExp("(?:^|\\.)(?:"+c.join("|")+")$")},G.MixedSet.prototype.test=function(){null===this.oneOf&&this.init();var a=u;return this.oneOf.test(a)&&this.noneOf.test(a)===!1};var H=function(a,b){this.s=a,this.tokenBeg=b};H.prototype.match=function(a,b){return a.startsWith(this.s,b-this.tokenBeg)},H.fid=H.prototype.fid=H.prototype.rtfid="a",H.prototype.toSelfie=H.prototype.rtCompile=function(){return this.s+"	"+this.tokenBeg},H.compile=function(a){return a.f+"	"+a.tokenBeg},H.fromSelfie=function(a){var b=a.indexOf("	");return new H(a.slice(0,b),y(a.slice(b+1)))};var I=function(a,b,c){this.s=a,this.tokenBeg=b,this.hnMatcher=G(c)};I.prototype.match=function(a,b){return a.startsWith(this.s,b-this.tokenBeg)&&this.hnMatcher.test()},I.fid=I.prototype.fid=I.prototype.rtfid="ah",I.prototype.toSelfie=I.prototype.rtCompile=function(){return this.s+"	"+this.tokenBeg+"	"+this.hnMatcher.toDomainOpt()},I.compile=function(a){return a.f+"	"+a.tokenBeg+"	"+a.domainOpt},I.fromSelfie=function(a){var b=a.split("	");return new I(b[0],y(b[1]),b[2])};var J=function(a){this.s=a};J.prototype.match=function(a,b){return a.startsWith(this.s,b)},J.fid=J.prototype.fid=J.prototype.rtfid="0a",J.prototype.toSelfie=J.prototype.rtCompile=function(){return this.s},J.compile=function(a){return a.f},J.fromSelfie=function(a){return new J(a)};var K=function(a,b){this.s=a,this.hnMatcher=G(b)};K.prototype.match=function(a,b){return a.startsWith(this.s,b)&&this.hnMatcher.test()},K.fid=K.prototype.fid=K.prototype.rtfid="0ah",K.prototype.toSelfie=K.prototype.rtCompile=function(){return this.s+"	"+this.hnMatcher.toDomainOpt()},K.compile=function(a){return a.f+"	"+a.domainOpt},K.fromSelfie=function(a){var b=a.indexOf("	");return new K(a.slice(0,b),a.slice(b+1))};var L=function(a){this.s=a};L.prototype.match=function(a,b){return a.startsWith(this.s,b-1)},L.fid=L.prototype.fid=L.prototype.rtfid="1a",L.prototype.toSelfie=L.prototype.rtCompile=function(){return this.s},L.compile=function(a){return a.f},L.fromSelfie=function(a){return new L(a)};var M=function(a,b){this.s=a,this.hnMatcher=G(b)};M.prototype.match=function(a,b){return a.startsWith(this.s,b-1)&&this.hnMatcher.test()},M.fid=M.prototype.fid=M.prototype.rtfid="1ah",M.prototype.toSelfie=M.prototype.rtCompile=function(){return this.s+"	"+this.hnMatcher.toDomainOpt()},M.compile=function(a){return a.f+"	"+a.domainOpt},M.fromSelfie=function(a){var b=a.indexOf("	");return new M(a.slice(0,b),a.slice(b+1))};var N=function(a){this.s=a};N.prototype.match=function(a){return a.startsWith(this.s)},N.fid=N.prototype.fid=N.prototype.rtfid="|a",N.prototype.toSelfie=N.prototype.rtCompile=function(){return this.s},N.compile=function(a){return a.f},N.fromSelfie=function(a){return new N(a)};var O=function(a,b){this.s=a,this.hnMatcher=G(b)};O.prototype.match=function(a){return a.startsWith(this.s)&&this.hnMatcher.test()},O.fid=O.prototype.fid=O.prototype.rtfid="|ah",O.prototype.toSelfie=O.prototype.rtCompile=function(){return this.s+"	"+this.hnMatcher.toDomainOpt()},O.compile=function(a){return a.f+"	"+a.domainOpt},O.fromSelfie=function(a){var b=a.indexOf("	");return new O(a.slice(0,b),a.slice(b+1))};var P=function(a){this.s=a};P.prototype.match=function(a){return a.endsWith(this.s)},P.fid=P.prototype.fid=P.prototype.rtfid="a|",P.prototype.toSelfie=P.prototype.rtCompile=function(){return this.s},P.compile=function(a){return a.f},P.fromSelfie=function(a){return new P(a)};var Q=function(a,b){this.s=a,this.hnMatcher=G(b)};Q.prototype.match=function(a){return a.endsWith(this.s)&&this.hnMatcher.test()},Q.fid=Q.prototype.fid=Q.prototype.rtfid="a|h",Q.prototype.toSelfie=Q.prototype.rtCompile=function(){return this.s+"	"+this.hnMatcher.toDomainOpt()},Q.compile=function(a){return a.f+"	"+a.domainOpt},Q.fromSelfie=function(a){var b=a.indexOf("	");return new Q(a.slice(0,b),a.slice(b+1))};var R=function(a){this.s=a};R.prototype.match=function(a,b){return a.startsWith(this.s,b)&&E(a,b)},R.fid=R.prototype.fid=R.prototype.rtfid="||a",R.prototype.toSelfie=R.prototype.rtCompile=function(){return this.s},R.compile=function(a){return a.f},R.fromSelfie=function(a){return new R(a)};var S=function(a,b){this.s=a,this.hnMatcher=G(b)};S.prototype.match=function(a,b){return a.startsWith(this.s,b)&&this.hnMatcher.test()&&E(a,b)},S.fid=S.prototype.fid=S.prototype.rtfid="||ah",S.prototype.toSelfie=S.prototype.rtCompile=function(){return this.s+"	"+this.hnMatcher.toDomainOpt()},S.compile=function(a){return a.f+"	"+a.domainOpt},S.fromSelfie=function(a){var b=a.indexOf("	");return new S(a.slice(0,b),a.slice(b+1))};var T=function(a,b){this.s=a,this.anchor=b,this.re=null};T.prototype.match=function(a){return null===this.re&&(this.re=C(this.s,this.anchor)),this.re.test(a)},T.fid=T.prototype.fid=T.prototype.rtfid="_",T.prototype.toSelfie=T.prototype.rtCompile=function(){return this.s+"	"+this.anchor},T.compile=function(a){return a.f+"	"+a.anchor},T.fromSelfie=function(a){var b=a.indexOf("	");return new T(a.slice(0,b),parseInt(a.slice(b+1),10))};var U=function(a,b,c){T.call(this,a,b),this.hnMatcher=G(c)};U.prototype=Object.create(T.prototype),U.prototype.constructor=U,U.prototype.match=function(a){return this.hnMatcher.test()&&T.prototype.match.call(this,a)},U.fid=U.prototype.fid=U.prototype.rtfid="_h",U.prototype.toSelfie=U.prototype.rtCompile=function(){return T.prototype.toSelfie.call(this)+"	"+this.hnMatcher.toDomainOpt()},U.compile=function(a){return T.compile(a)+"	"+a.domainOpt},U.fromSelfie=function(a){var b=a.split("	");return new U(b[0],parseInt(b[1],10),b[2])};var V=function(a,b){this.s=a,this.anchor=b,this.re=null};V.prototype.match=function(a){null===this.re&&(this.re=C("||"+this.s,this.anchor));var b=a.search(this.re);return-1!==b&&E(a,b)},V.fid=V.prototype.fid=V.prototype.rtfid="||_",V.prototype.toSelfie=V.prototype.rtCompile=function(){return this.s+"	"+this.anchor},V.compile=function(a){return a.f+"	"+a.anchor},V.fromSelfie=function(a){var b=a.indexOf("	");return new V(a.slice(0,b),parseInt(a.slice(b+1),10))};var W=function(a,b,c){V.call(this,a,b),this.hnMatcher=G(c)};W.prototype=Object.create(V.prototype),W.prototype.constructor=W,W.prototype.match=function(a){return this.hnMatcher.test()&&V.prototype.match.call(this,a)},W.fid=W.prototype.fid=W.prototype.rtfid="||_h",W.prototype.toSelfie=W.prototype.rtCompile=function(){return this.s+"	"+this.anchor+"	"+this.hnMatcher.toDomainOpt()},W.compile=function(a){return a.f+"	"+a.anchor+"	"+a.domainOpt},W.fromSelfie=function(a){var b=a.split("	");return new W(b[0],parseInt(b[1],10),b[2])};var X=function(a){this.re=new RegExp(a,"i")};X.prototype.match=function(a){return this.re.test(a)},X.fid=X.prototype.fid=X.prototype.rtfid="//",X.prototype.toSelfie=X.prototype.rtCompile=function(){return this.re.source},X.compile=function(a){return a.f},X.fromSelfie=function(a){return new X(a)};var Y=function(a,b){this.re=new RegExp(a,"i"),this.hnMatcher=G(b)};Y.prototype.match=function(a){return this.hnMatcher.test()&&this.re.test(a)},Y.fid=Y.prototype.fid=Y.prototype.rtfid="//h",Y.prototype.toSelfie=Y.prototype.rtCompile=function(){return this.re.source+"	"+this.hnMatcher.toDomainOpt()},Y.compile=function(a){return a.f+"	"+a.domainOpt},Y.fromSelfie=function(a){var b=a.indexOf("	");return new Y(a.slice(0,b),a.slice(b+1))};var Z=function(){this.h="",this.dict=new Set};Object.defineProperty(Z.prototype,"size",{get:function(){return this.dict.size}}),Z.prototype.add=function(a){return this.dict.has(a)?!1:(this.dict.add(a),!0)},Z.prototype.remove=function(a){return this.dict["delete"](a)},Z.prototype.match=function(){for(var a,b=v;this.dict.has(b)===!1;){if(a=b.indexOf("."),-1===a)return this.h="",!1;b=b.slice(a+1)}return this.h=b,this},Z.fid=Z.prototype.fid="{h}",Z.rtfid=".",Z.prototype.rtCompile=function(){return this.h},Z.prototype.toSelfie=function(){return JSON.stringify(a.setToArray(this.dict))},Z.fromSelfie=function(b){var c=new Z;return c.dict=a.setFromArray(JSON.parse(b)),c};var $=function(a,b){this.promoted=0,this.vip=16,this.f=null,this.filters=[],void 0!==a&&(this.filters[0]=a,void 0!==b&&(this.filters[1]=b))};Object.defineProperty($.prototype,"rtfid",{get:function(){return this.f.rtfid}}),$.prototype.add=function(a){this.filters.push(a)},$.prototype.remove=function(a,b){for(var c,d=this.filters.length;d--;)c=this.filters[d],c.fid===a&&c.toSelfie()===b&&this.filters.splice(d,1)},$.prototype.promote=function(a){for(var b=this.filters,c=b.length>>>1;c>a&&(c>>>=1,!(c<this.vip)););if(!(c>=a)){var d=this.promoted%c,e=b[d];b[d]=b[a],b[a]=e,this.promoted+=1}},$.prototype.match=function(a,b){for(var c=this.filters,d=c.length,e=0;d>e;e++)if(c[e].match(a,b))return this.f=c[e],e>=this.vip&&this.promote(e),!0;return!1},$.prototype.fid="[]",$.prototype.toSelfie=function(){return this.filters.length.toString()},$.prototype.rtCompile=function(){return this.f.rtCompile()},$.fromSelfie=function(){return new $};var _=function(){this.cantWebsocket=vAPI.cantWebsocket,this.reBadDomainOptChars=/[*+?^${}()[\]\\]/,this.reHostnameRule1=/^[0-9a-z][0-9a-z.-]*[0-9a-z]$/i,this.reHostnameRule2=/^\**[0-9a-z][0-9a-z.-]*[0-9a-z]\^?$/i,this.reCleanupHostnameRule2=/^\**|\^$/g,this.reHasWildcard=/[\^\*]/,this.reCanTrimCarets1=/^[^*]*$/,this.reCanTrimCarets2=/^\^?[^^]+[^^][^^]+\^?$/,this.reHasUppercase=/[A-Z]/,this.reIsolateHostname=/^(\*?\.)?([^\x00-\x24\x26-\x2C\x2F\x3A-\x5E\x60\x7B-\x7F]+)(.*)/,this.reHasUnicode=/[^\x00-\x7F]/,this.reWebsocketAny=/^ws[s*]?(?::\/?\/?)?\*?$/,this.domainOpt="",this.reset()};_.prototype.toNormalizedType={stylesheet:"stylesheet",image:"image",object:"object","object-subrequest":"object",script:"script",xmlhttprequest:"xmlhttprequest",subdocument:"sub_frame",font:"font",media:"media",websocket:"websocket",other:"other",beacon:"other",ping:"other",popunder:"popunder",document:"main_frame",generichide:"generichide",elemhide:"generichide","inline-script":"inline-script",popup:"popup"},_.prototype.reset=function(){return this.action=b,this.anchor=0,this.badFilter=!1,this.elemHiding=!1,this.f="",this.firstParty=!1,this.fopts="",this.hostnameAnchored=!1,this.hostnamePure=!1,this.domainOpt="",this.isRegex=!1,this.raw="",this.redirect=!1,this.thirdParty=!1,this.token="*",this.tokenBeg=0,this.types=0,this.important=0,this.unsupported=!1,this},_.prototype.bitFromType=function(a){return 1<<(i[a]>>>4)-1},_.prototype.parseTypeOption=function(a,b){var c=this.bitFromType(this.toNormalizedType[a]);return b?(0!==(c&l)&&0===(this.types&l)&&(this.types|=l),void(this.types&=~c)):void(this.types|=c)},_.prototype.parsePartyOption=function(a,b){a&&(b=!b),b?this.firstParty=!0:this.thirdParty=!0},_.prototype.parseDomainOption=function(a){if(this.reHasUnicode.test(a)){for(var b=a.split("|"),c=b.length;c--;)b[c]=punycode.toASCII(b[c]);a=b.join("|")}return this.reBadDomainOptChars.test(a)?"":a},_.prototype.parseOptions=function(a){this.fopts=a;for(var c,e,f=a.split(","),g=0;g<f.length;g++)if(c=f[g],e=c.startsWith("~"),e&&(c=c.slice(1)),"third-party"!==c){if("elemhide"===c||"generichide"===c){if(e===!1){this.parseTypeOption("generichide",!1);continue}this.unsupported=!0;break}if("document"===c){if(this.action===b){this.parseTypeOption("document",e);continue}this.unsupported=!0;break}if(this.toNormalizedType.hasOwnProperty(c))this.parseTypeOption(c,e),"other"===c&&this.parseTypeOption("websocket",e);else if(c.startsWith("domain=")){if(this.domainOpt=this.parseDomainOption(c.slice(7)),""===this.domainOpt){this.unsupported=!0;break}}else if("important"!==c)if("first-party"!==c){if(c.startsWith("redirect=")){if(this.action===b){this.redirect=!0;continue}this.unsupported=!0;break}if("empty"!==c){if("badfilter"!==c){this.unsupported=!0;break}this.badFilter=!0}}else this.parsePartyOption(!0,e);else this.important=d}else this.parsePartyOption(!1,e)},_.prototype.parse=function(a){this.reset();var b=this.raw=a;if(this.reHostnameRule1.test(b))return this.f=b,this.hostnamePure=this.hostnameAnchored=!0,this;var d=b.indexOf("#");if(-1!==d){var e=b.charAt(d+1);if("#"===e||"@"===e)return console.error("static-net-filtering.js > unexpected cosmetic filters"),this.elemHiding=!0,this}if(b.startsWith("@@")&&(this.action=c,b=b.slice(2)),(b.startsWith("/")===!1||b.endsWith("/")===!1)&&(d=b.lastIndexOf("$"),-1!==d)){if(-1!==b.indexOf("$$"))return this.unsupported=!0,this;this.parseOptions(b.slice(d+1)),b=b.slice(0,d)}if(b.startsWith("/")&&b.endsWith("/")&&b.length>2)return this.isRegex=!0,this.f=b.slice(1,-1),this.f=A(this.f),""===this.f&&(console.error("uBlock Origin> discarding bad regular expression-based network filter '%s': '%s'",a,A.message),this.unsupported=!0),this;if(b.startsWith("||")){if(this.hostnameAnchored=!0,b=b.slice(2),this.reHasUnicode.test(b)){var f=this.reIsolateHostname.exec(b);f&&(b=f[1]+punycode.toASCII(f[2])+f[3])}if(b.startsWith("^"))return this.unsupported=!0,this;if(""===this.domainOpt&&this.reHostnameRule2.test(b))return this.f=b.replace(this.reCleanupHostnameRule2,""),this.hostnamePure=!0,this}return b.startsWith("|")&&(this.anchor=-1,b=b.slice(1)),b.endsWith("|")&&(this.anchor=1,b=b.slice(0,-1)),this.reHasWildcard.test(b)&&(b.startsWith("*")&&this.hostnameAnchored===!1&&(b=b.replace(/^\*+([^%0-9a-z])/,"$1")),b.endsWith("*")&&(b=b.replace(/([^%0-9a-z])\*+$/,"$1"))),""===b&&(b="*"),"*"===b&&(this.hostnameAnchored=!1),this.f=this.reHasUppercase.test(b)?b.toLowerCase():b,this.cantWebsocket&&-1===this.anchor&&this.firstParty===!1&&this.thirdParty===!1&&this.reWebsocketAny.test(this.f)&&(this.f="*",this.types=this.bitFromType("websocket")),this};var aa=/^[0-9a-z]+/g,ba=/[%0-9a-z]{2,}/g,ca={com:!0,http:!0,https:!0,icon:!0,images:!0,img:!0,js:!0,net:!0,news:!0,www:!0},da=function(a){ba.lastIndex=0;for(var b,c,d=null;b=ba.exec(a);)if(c=b.index,(0===c||"*"!==a.charAt(c-1))&&"*"!==a.charAt(ba.lastIndex)){if(!ca.hasOwnProperty(b[0]))return b;null===d&&(d=b)}return d},ea=function(a){return aa.lastIndex=0,aa.exec(a)};_.prototype.makeToken=function(){if(!this.isRegex&&"*"!==this.f){var a=this.hostnameAnchored&&-1===this.f.indexOf("*")?ea(this.f):da(this.f);null!==a&&0!==a[0].length&&(this.token=a[0],this.tokenBeg=a.index)}};var fa=function(){this.reIsGeneric=/[\^\*]/,this.filterParser=new _,this.urlTokenizer=a.urlTokenizer,this.reset()};return fa.prototype.reset=function(){this.frozen=!1,this.processedFilterCount=0,this.acceptedCount=0,this.rejectedCount=0,this.allowFilterCount=0,this.blockFilterCount=0,this.discardedCount=0,this.badFilters=new Set,this.duplicateBuster=new Set,this.categories=new Map,this.filterParser.reset(),this.fclassLast=null,this.fdataLast=null,this.filterLast=null,this.keyRegister=void 0,this.tokenRegister=void 0,this.fRegister=null},fa.prototype.freeze=function(){w("allFilters",this.categories),this.removeBadFilters(),this.duplicateBuster=new Set,this.filterParser.reset(),this.fclassLast=null,this.fdataLast=null,this.filterLast=null,this.frozen=!0},fa.prototype.factories={"[]":$,a:H,ah:I,"0a":J,"0ah":K,"1a":L,"1ah":M,"|a":N,"|ah":O,"a|":P,"a|h":Q,"||a":R,"||ah":S,"//":X,"//h":Y,"{h}":Z,_:T,_h:U,"||_":V,"||_h":W},fa.prototype.filterFromSelfie=function(a,b){return(b!==this.fdataLast||a!==this.fclassLast)&&(this.fclassLast=a,this.fdataLast=b,this.filterLast=this.factories[a].fromSelfie(b)),this.filterLast},fa.prototype.toSelfie=function(){var a=function(a){for(var b,c,d,e,f=[],g=a.entries();b=g.next(),!b.done;)if(f.push("k2	"+b.value[0]),c=b.value[1],f.push(c.fid+"	"+c.toSelfie()),"[]"===c.fid){d=c.filters;for(var h=0,i=d.length;i>h;h++)e=d[h],f.push(e.fid+"	"+e.toSelfie())}return f.join("\n")},b=function(b){for(var c,d=[],e=b.entries();c=e.next(),!c.done;)d.push("k1	"+c.value[0]),d.push(a(c.value[1]));return d.join("\n")};return{processedFilterCount:this.processedFilterCount,acceptedCount:this.acceptedCount,rejectedCount:this.rejectedCount,allowFilterCount:this.allowFilterCount,blockFilterCount:this.blockFilterCount,discardedCount:this.discardedCount,categories:b(this.categories)}},fa.prototype.fromSelfie=function(a){this.frozen=!0,this.processedFilterCount=a.processedFilterCount,this.acceptedCount=a.acceptedCount,this.rejectedCount=a.rejectedCount,this.allowFilterCount=a.allowFilterCount,this.blockFilterCount=a.blockFilterCount,this.discardedCount=a.discardedCount;for(var b,c,d,e,f,g,h,i,j,k=this.categories,l=null,m=a.categories,n=m.length,o=0;n>o;)e=m.indexOf("\n",o),0>e&&(e=n),f=m.slice(o,e),o=e+1,g=f.indexOf("	"),h=f.slice(0,g),i=f.slice(g+1),"k1"!==h?"k2"!==h?(j=this.filterFromSelfie(h,i),null!==l?l.add(j):(l=j,d.set(c,l))):(c=i,l=null):(b=i,d=new Map,k.set(b,d),l=null)},fa.prototype.getFilterClass=function(a){var b=a.f;return 0!==a.domainOpt.length?a.isRegex?Y:this.reIsGeneric.test(b)||"*"===a.token?a.hostnameAnchored?W:U:a.anchor<0?O:a.anchor>0?a.hostnameAnchored?W:Q:a.hostnameAnchored?S:0===a.tokenBeg?K:1===a.tokenBeg?M:I:a.isRegex?X:this.reIsGeneric.test(b)||"*"===a.token?a.hostnameAnchored?V:T:a.anchor<0?N:a.anchor>0?a.hostnameAnchored?V:P:a.hostnameAnchored?R:0===a.tokenBeg?J:1===a.tokenBeg?L:H},fa.prototype.compile=function(b,c){var d=b.trim();if(0===d.length)return!1;var e=this.filterParser.parse(d);if(e.elemHiding)return!1;if(e.unsupported)return a.logger.writeOne("","error","Network filtering – invalid filter: "+b),!1;if(e.hostnamePure&&this.compileHostnameOnlyFilter(e,c))return!0;var f=this.compileFilter(e,c);return f===!1?!1:!0},fa.prototype.compileHostnameOnlyFilter=function(a,b){var c,d=a.badFilter?"n-":"n";c=a.firstParty===a.thirdParty?e:a.firstParty?f:g;var h=a.action|a.important|c,i=a.types;if(0===i)return b.push(d+D(h)+"."+a.f),!0;var j=1;do 1&i&&b.push(d+D(h|j<<4)+"."+a.f),j+=1,i>>>=1;while(0!==i);return!0},fa.prototype.compileFilter=function(a,b){a.makeToken();var c=e;a.firstParty!==a.thirdParty&&(c=a.firstParty?f:g);var d=this.getFilterClass(a);return null===d?!1:(this.compileToAtomicFilter(d,a,c,b),!0)},fa.prototype.compileToAtomicFilter=function(b,c,d,e){var f=c.badFilter?"n-":"n",g=c.action|c.important|d,h=c.types;if(0===h)return void e.push(f+D(g)+""+c.token+""+b.fid+""+b.compile(c));var i=1;do 1&h&&e.push(f+D(g|i<<4)+""+c.token+""+b.fid+""+b.compile(c)),i+=1,h>>>=1;while(0!==h);if(c.redirect&&!c.badFilter){var j=a.redirectEngine.compileRuleFromStaticFilter(c.raw);if(Array.isArray(j)!==!1)for(var k=j.length;k--;)e.push("n=>"+j[k])}},fa.prototype.fromCompiledContent=function(b){for(var c,d,e,f,g,h,i,j,k=new a.FieldIterator("");b.eot()===!1;){if(c=b.next(),110!==c.charCodeAt(0))return void b.rewind();"n-"!==k.first(c)?(d=k.next(),e=k.next(),f=k.next(),g=k.next(),"=>"!==f?(this.acceptedCount+=1,h=this.categories.get(d),void 0===h&&(h=new Map,this.categories.set(d,h)),i=h.get(e),"."!==e?this.duplicateBuster.has(c)?this.discardedCount+=1:(this.duplicateBuster.add(c),j=this.filterFromSelfie(f,g),void 0!==i?"[]"!==i.fid?h.set(e,new $(i,j)):i.add(j):h.set(e,j)):(void 0===i&&(i=new Z,h.set(".",i)),i.add(f)===!1&&(this.discardedCount+=1))):a.redirectEngine.fromCompiledRule(g)):this.badFilters.add(c)}},fa.prototype.removeBadFilters=function(){for(var b,c,d,e,f,g,h=a.setToArray(this.badFilters),i=new a.FieldIterator(""),j=h.length;j--;)i.first(h[j]),b=i.next(),c=i.next(),d=i.next(),e=i.next(),f=this.categories.get(b),void 0!==f&&(g=f.get(c),void 0!==g&&(g instanceof $?(g.remove(d,e),1===g.filters.length&&f.set(c,g.filters[0])):g instanceof Z?(g.remove(d),0===g.size&&(f["delete"](c),0===f.size&&this.categories["delete"](b))):g.fid!==d||g.toSelfie()!==e||(f["delete"](c),0===f.size&&this.categories["delete"](b))))},fa.prototype.filterStringFromCompiled=function(a){var b=[],c=a.split(""),d="",e=0|parseInt(c[0],16);1&e&&(d+="@@");var f="."===c[1]?".":c[2],g="."!==f?c[3].split("	"):[];switch(f){case".":d+="||"+c[2]+"^";break;case"a":case"ah":case"0a":case"0ah":case"1a":case"1ah":case"_":case"_h":d+=g[0];break;case"|a":case"|ah":d+="|"+g[0];break;case"a|":case"a|h":d+=g[0]+"|";break;case"||a":case"||ah":case"||_":case"||_h":d+="||"+g[0];break;case"//":case"//h":d+="/"+g[0]+"/"}switch(f){case"0ah":case"1ah":case"|ah":case"a|h":case"||ah":case"||_h":case"//h":b.push("domain="+g[1]);break;case"ah":case"_h":b.push("domain="+g[2])}return 2&e&&b.push("important"),8&e?b.push("third-party"):4&e&&b.push("first-party"),240&e&&b.push(k[e>>>4]),0!==b.length&&(d+="$"+b.join(",")),d},fa.prototype.filterRegexFromCompiled=function(a,b){var c=a.split(""),d="."===c[1]?".":c[2],e="."!==d?c[3].split("	"):[],f=null;switch(d){case".":f=C(c[2],0,b);break;case"a":case"ah":case"0a":case"0ah":case"1a":case"1ah":case"_":case"_h":f=C(e[0],0,b);break;case"||a":case"||ah":case"||_":case"||_h":f=C("||"+e[0],0,b);break;case"|a":case"|ah":f=C(e[0],-1,b);break;case"a|":case"a|h":f=C(e[0],1,b);break;case"//":case"//h":f=new RegExp(e[0])}return f},fa.prototype.matchTokens=function(a,b){var c=a.get(".");if(void 0!==c&&c.match())return this.tokenRegister=".",this.fRegister=c,!0;for(var d,e,f=this.urlTokenizer.getTokens(),g=0;d=f[g++],e=d.token,e;)if(c=a.get(e),void 0!==c&&c.match(b,d.beg))return this.tokenRegister=e,this.fRegister=c,!0;return c=a.get("*"),void 0!==c&&c.match(b)?(this.tokenRegister="*",this.fRegister=c,!0):!1},fa.prototype.matchStringGenericHide=function(b,c){var d=this.urlTokenizer.setURL(c);v=a.URI.hostnameFromURI(d);var e=this.categories.get(D(s));return e&&this.matchTokens(e,d)!==!1?(e=this.categories.get(D(t)),e&&this.matchTokens(e,d)?(this.keyRegister=t,!0):(this.keyRegister=s,!1)):void(this.fRegister=null)},fa.prototype.matchStringExactType=function(e,h,j){if("generichide"===j)return this.matchStringGenericHide(e,h);var k=i[j];if(void 0===k)return void 0;var l=this.urlTokenizer.setURL(h);u=e.pageHostname||"",v=a.URI.hostnameFromURI(l);var m,n,p=z(e.pageDomain,v)?f:g,q=this.categories;return this.fRegister=null,m=o|d|k,(n=q.get(D(m)))&&this.matchTokens(n,l)?(this.keyRegister=m,!0):(m=b|d|k|p,(n=q.get(D(m)))&&this.matchTokens(n,l)?(this.keyRegister=m,!0):(m=o|k,(n=q.get(D(m)))&&this.matchTokens(n,l)&&(this.keyRegister=m),null===this.fRegister&&(m=b|k|p,(n=q.get(D(m)))&&this.matchTokens(n,l)&&(this.keyRegister=m)),null!==this.fRegister?(m=r|k,(n=q.get(D(m)))&&this.matchTokens(n,l)?(this.keyRegister=m,!1):(m=c|k|p,(n=q.get(D(m)))&&this.matchTokens(n,l)?(this.keyRegister=m,!1):!0)):void 0))},fa.prototype.matchString=function(a){var e=i[a.requestType];if(void 0===e)e=j;else if(0===e||e>j)return this.matchStringExactType(a,a.requestURL,a.requestType);var h=this.urlTokenizer.setURL(a.requestURL);u=a.pageHostname||"",v=a.requestHostname,this.fRegister=null;var k,l,s=z(a.pageDomain,a.requestHostname)?f:g,t=this.categories;return k=m|d,(l=t.get(D(k)))&&this.matchTokens(l,h)?(this.keyRegister=k,!0):(k=n|d|s,(l=t.get(D(k)))&&this.matchTokens(l,h)?(this.keyRegister=k,!0):(k=o|d|e,(l=t.get(D(k)))&&this.matchTokens(l,h)?(this.keyRegister=k,!0):(k=b|d|e|s,(l=t.get(D(k)))&&this.matchTokens(l,h)?(this.keyRegister=k,!0):(k=m,(l=t.get(D(k)))&&this.matchTokens(l,h)&&(this.keyRegister=k),null===this.fRegister&&(k=n|s,(l=t.get(D(k)))&&this.matchTokens(l,h)&&(this.keyRegister=k),null===this.fRegister&&(k=o|e,(l=t.get(D(k)))&&this.matchTokens(l,h)&&(this.keyRegister=k),null===this.fRegister&&(k=b|e|s,(l=t.get(D(k)))&&this.matchTokens(l,h)&&(this.keyRegister=k)))),null!==this.fRegister?(k=p,(l=t.get(D(k)))&&this.matchTokens(l,h)?(this.keyRegister=k,!1):(k=q|s,(l=t.get(D(k)))&&this.matchTokens(l,h)?(this.keyRegister=k,!1):(k=r|e,(l=t.get(D(k)))&&this.matchTokens(l,h)?(this.keyRegister=k,!1):(k=c|e|s,(l=t.get(D(k)))&&this.matchTokens(l,h)?(this.keyRegister=k,!1):!0)))):void 0))))},fa.prototype.toResultString=function(a){if(null===this.fRegister)return"";var b=1&this.keyRegister?"sa:":"sb:";return a?(b+=D(this.keyRegister)+""+this.tokenRegister+"",b+="."===this.tokenRegister?this.fRegister.rtCompile():this.fRegister.rtfid+""+this.fRegister.rtCompile()):b},fa.prototype.getFilterCount=function(){return this.acceptedCount-this.discardedCount},new fa}();