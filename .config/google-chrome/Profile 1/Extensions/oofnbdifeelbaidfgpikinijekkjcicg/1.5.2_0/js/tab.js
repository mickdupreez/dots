!function(){"use strict";var a=ÂµBlock;a.normalizePageURL=function(a,b){if(vAPI.isBehindTheSceneTabId(a))return"http://behind-the-scene/";var c=this.URI.set(b),d=c.scheme;if("https"===d||"http"===d)return c.normalizedURI();var e=d+"-scheme";return""!==c.hostname?e=c.hostname+"."+e:"about"===d&&""!==c.path&&(e=c.path+"."+e),"http://"+e+"/"},a.tabContextManager=function(){var b=Object.create(null),c="",d=0,e=Object.create(null),f=function(a,b){this.targetTabId=a,this.openerTabId=b,this.selfDestructionTimer=null,this.launchSelfDestruction()};f.prototype.destroy=function(){null!==this.selfDestructionTimer&&clearTimeout(this.selfDestructionTimer),delete e[this.targetTabId]},f.prototype.launchSelfDestruction=function(){null!==this.selfDestructionTimer&&clearTimeout(this.selfDestructionTimer),this.selfDestructionTimer=vAPI.setTimeout(this.destroy.bind(this),1e4)};var g=function(a){var b,c=e;for(var d in c)b=c[d],(a===d||a===b.openerTabId)&&(vAPI.tabs.onPopupUpdated(d,b.openerTabId)===!0?b.destroy():b.launchSelfDestruction())};vAPI.tabs.onPopupCreated=function(a,b){var c=e[a];void 0===c&&(e[a]=new f(a,b)),g(a)};var h=6e5,i=function(a,b){this.url=a,this.committed=b,this.tstamp=Date.now()},j=function(a){this.tabId=a.toString(),this.stack=[],this.rawURL=this.normalURL=this.rootHostname=this.rootDomain="",this.commitTimer=null,this.gcTimer=null,this.onGCBarrier=!1,this.netFiltering=!0,this.netFilteringReadTime=0,b[a]=this};j.prototype.destroy=function(){vAPI.isBehindTheSceneTabId(this.tabId)||(null!==this.gcTimer&&(clearTimeout(this.gcTimer),this.gcTimer=null),delete b[this.tabId])},j.prototype.onTab=function(a){a?this.gcTimer=vAPI.setTimeout(this.onGC.bind(this),h):this.destroy()},j.prototype.onGC=function(){vAPI.isBehindTheSceneTabId(this.tabId)||this.onGCBarrier||(this.onGCBarrier=!0,this.gcTimer=null,vAPI.tabs.get(this.tabId,this.onTab.bind(this)),this.onGCBarrier=!1)},j.prototype.onCommit=function(){if(!vAPI.isBehindTheSceneTabId(this.tabId)){this.commitTimer=null;for(var a=this.stack.length;a--&&!this.stack[a].committed;);-1===a&&0!==this.stack.length&&(this.stack[0].committed=!0,a=0),a+=1,a<this.stack.length&&(this.stack.length=a,this.update())}},j.prototype.autodestroy=function(){vAPI.isBehindTheSceneTabId(this.tabId)||(this.gcTimer=vAPI.setTimeout(this.onGC.bind(this),h))},j.prototype.update=function(){if(this.netFilteringReadTime=0,0===this.stack.length)return void(this.rawURL=this.normalURL=this.rootHostname=this.rootDomain="");var b=this.stack[this.stack.length-1];this.rawURL=b.url,this.normalURL=a.normalizePageURL(this.tabId,this.rawURL),this.rootHostname=a.URI.hostnameFromURI(this.normalURL),this.rootDomain=a.URI.domainFromHostname(this.rootHostname)||this.rootHostname},j.prototype.push=function(a){if(!vAPI.isBehindTheSceneTabId(this.tabId)){var b=this.stack.length;(0===b||this.stack[b-1].url!==a)&&(this.stack.push(new i(a)),this.update(),g(this.tabId),null!==this.commitTimer&&clearTimeout(this.commitTimer),this.commitTimer=vAPI.setTimeout(this.onCommit.bind(this),500))}},j.prototype.commit=function(a){vAPI.isBehindTheSceneTabId(this.tabId)||(this.stack=[new i(a,!0)],this.update())},j.prototype.getNetFilteringSwitch=function(){return this.netFilteringReadTime>a.netWhitelistModifyTime?this.netFiltering:(this.netFiltering=a.getNetFilteringSwitch(this.normalURL),this.netFiltering&&this.rawURL!==this.normalURL&&""!==this.rawURL&&(this.netFiltering=a.getNetFilteringSwitch(this.rawURL)),this.netFilteringReadTime=Date.now(),this.netFiltering)};var k=function(a,e){var f=b[a];return void 0===f&&(f=new j(a),f.autodestroy()),f.push(e),c=e,d=Date.now(),f},l=function(a){return b[a]||null},m=function(a){var e=b[a];return void 0!==e?e:(""!==c&&d+500<Date.now()&&(c=""),""!==c?k(a,c):b[vAPI.noTabId])},n=function(a,c){var d=b[a];return void 0===d?d=k(a,c):(d.commit(c),g(a)),d},o=function(a){return void 0!==b[a]};!function(){var b=new j(vAPI.noTabId);b.stack.push(new i("",!0)),b.rawURL="",b.normalURL=a.normalizePageURL(b.tabId),b.rootHostname=a.URI.hostnameFromURI(b.normalURL),b.rootDomain=a.URI.domainFromHostname(b.rootHostname)}();var p=[],q=function(a){this.init(a)};q.prototype.init=function(a){var b=l(a);return this.rootHostname=b.rootHostname,this.rootDomain=b.rootDomain,this.pageHostname=this.pageDomain=this.requestURL=this.requestHostname=this.requestDomain="",this},q.prototype.dispose=function(){p.push(this)};var r=function(a){return p.length?p.pop().init(a):new q(a)};return{push:k,commit:n,lookup:l,mustLookup:m,exists:o,createContext:r}}(),vAPI.tabs.onNavigation=function(b){if(0===b.frameId){a.tabContextManager.commit(b.tabId,b.url);var c=a.bindTabToPageStats(b.tabId,"tabCommitted");c&&c.journalAddRootFrame("committed",b.url)}},vAPI.tabs.onUpdated=function(b,c,d){d.url&&""!==d.url&&c.url&&(a.tabContextManager.commit(b,c.url),a.bindTabToPageStats(b,"tabUpdated"))},vAPI.tabs.onClosed=function(b){vAPI.isBehindTheSceneTabId(b)||a.unbindTabFromPageStats(b)},vAPI.tabs.onPopupUpdated=function(){var b={},c=function(a,b){if(""===b)return!0;var c=a.indexOf("://");return-1===c?!1:(a=a.slice(c),c=b.indexOf("://"),-1===c?!1:b.slice(c)!==a)},d=function(d,e,f,g){var h=a.URI.hostnameFromURI(d),i=a.URI.domainFromHostname(h);if(b.pageHostname=h,b.pageDomain=i,b.rootURL=d,b.rootHostname=h,b.rootDomain=i,b.requestURL=e,b.requestHostname=a.URI.hostnameFromURI(e),b.requestType="popup",""!==h&&"about:blank"!==e){if(a.hnSwitches.evaluateZ("no-popups",h)&&"string"==typeof f&&c(e,f))return"ub:no-popups: "+a.hnSwitches.z+" true";if(a.sessionURLFiltering.evaluateZ(h,e,g),1===a.sessionURLFiltering.r&&a.sessionURLFiltering.type===g||2===a.sessionURLFiltering.r)return a.sessionURLFiltering.toFilterString();if(a.sessionFirewall.evaluateCellZY(h,b.requestHostname,g),2===a.sessionFirewall.r)return a.sessionFirewall.toFilterString()}var j=a.staticNetFilteringEngine;return a.getNetFilteringSwitch(e)&&void 0!==j.matchStringExactType(b,e,g)?j.toResultString(a.logger.isEnabled()):""},e=function(b,c,d){if(d.startsWith("sb:")===!1)return"";var e=a.staticNetFilteringEngine,f=e.tokenRegister;if("*"===f)return"";if("."===f)return d;d=e.toResultString(!0);var g=e.filterRegexFromCompiled(d.slice(3));if(null===g)return"";var h=g.exec(b);if(null===h)return"";var i=h.index,j=i+h[0].length,k=b.indexOf(c);return-1===k?"":i>=k&&i<k+c.length&&j>k?d:""},f=function(b,c){var f=d(c,b,null,"popunder");if(a.isBlockResult(f))return f;var g=b,h=a.URI.hostnameFromURI(g);return""===h?"":(f=e(g,h,d(c,g,null,"popup")),""!==f?f:(g=a.URI.originFromURI(g),""===g?"":e(g,h,d(c,g,null,"popup"))))};return function(c,e){var g=a.tabContextManager.lookup(e);if(null!==g){var h=g.rawURL;if(""!==h&&(g=a.tabContextManager.lookup(c),null!==g)){var i=g.rawURL;if(""!==i&&a.getNetFilteringSwitch(h)!==!1&&a.getNetFilteringSwitch(a.normalizePageURL(e,h))!==!1){if(i.startsWith(vAPI.getURL("document-blocked.html"))){var j=/details=([^&]+)/.exec(i);null!==j&&(i=JSON.parse(atob(j[1])).url)}var k="popup",l=d(h,i,a.mouseURL,"popup");if(""===l&&(l=f(h,i),a.isBlockResult(l)&&(k="popunder")),a.logger.isEnabled()&&a.logger.writeOne("popup"===k?e:c,"net",l,k,"popup"===k?i:h,a.URI.hostnameFromURI(b.rootURL),a.URI.hostnameFromURI(b.rootURL)),!a.isAllowResult(l)){var m=a.pageStoreFromTabId(e);return m&&(m.journalAddRequest(b.requestHostname,l),m.popupBlockedCount+=1),a.userSettings.showIconBadge&&a.updateBadgeAsync(e),"popup"===k?(a.unbindTabFromPageStats(c),vAPI.tabs.remove(c,!1)):(a.unbindTabFromPageStats(e),vAPI.tabs.remove(e,!0)),!0}}}}}}(),vAPI.tabs.registerListeners(),a.bindTabToPageStats=function(b,c){if(this.updateBadgeAsync(b),a.tabContextManager.exists(b)===!1)return this.unbindTabFromPageStats(b),null;var d=this.pageStores[b];return d?vAPI.isBehindTheSceneTabId(b)?d:"beforeRequest"===c?d:(d.reuse(c),this.updateTitle(b),this.pageStoresToken=Date.now(),d):(this.updateTitle(b),this.pageStoresToken=Date.now(),this.pageStores[b]=this.PageStore.factory(b))},a.unbindTabFromPageStats=function(a){var b=this.pageStores[a];void 0!==b&&(b.dispose(),delete this.pageStores[a],this.pageStoresToken=Date.now())},a.pageStoreFromTabId=function(a){return this.pageStores[a]||null},a.mustPageStoreFromTabId=function(a){return this.pageStores[a]||this.pageStores[vAPI.noTabId]},a.pageStores[vAPI.noTabId]=a.PageStore.factory(vAPI.noTabId),a.pageStores[vAPI.noTabId].title=vAPI.i18n("logBehindTheScene"),a.updateBadgeAsync=function(){var a=Object.create(null),b=function(b){delete a[b];var c=!1,d="",e=this.pageStoreFromTabId(b);null!==e&&(c=e.getNetFilteringSwitch(),c&&this.userSettings.showIconBadge&&e.perLoadBlockedRequestCount&&(d=this.formatCount(e.perLoadBlockedRequestCount))),vAPI.setIcon(b,c?"on":"off",d)};return function(c){a[c]||vAPI.isBehindTheSceneTabId(c)||(a[c]=vAPI.setTimeout(b.bind(this,c),666))}}(),a.updateTitle=function(){var b=Object.create(null),c=Object.create(null),d=499,e=function(a){delete c[a]},f=function(e){var f=c[e];return void 0===f?!1:1===f?(delete c[e],!1):(c[e]=f-1,b[e]=vAPI.setTimeout(h.bind(a,e),d),!0)},g=function(a,b){if(!b)return e(a);var c=this.pageStoreFromTabId(a);if(null===c)return e(a);if(c.rawURL=b.url,this.pageStoresToken=Date.now(),b.title||!f(a)){var d=b.title&&b.title===c.title;c.title=b.title||b.url||"",this.pageStoresToken=Date.now(),(d||!f(a))&&e(a)}},h=function(a){delete b[a],vAPI.tabs.get(a,g.bind(this,a))};return function(a){vAPI.isBehindTheSceneTabId(a)||(b[a]&&clearTimeout(b[a]),b[a]=vAPI.setTimeout(h.bind(this,a),d),c[a]=5)}}();var b=9e5,c=0,d=10,e=function(){var f=vAPI.tabs,g=Object.keys(a.pageStores).sort(),h=function(b){f.get(b,function(c){c||a.unbindTabFromPageStats(b)})};c>=g.length&&(c=0);for(var i,j=Math.min(c+d,g.length),k=c;j>k;k++)i=g[k],vAPI.isBehindTheSceneTabId(i)||h(i);c=j,vAPI.setTimeout(e,b)};vAPI.setTimeout(e,b)}();