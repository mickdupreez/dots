!function(){"use strict";function a(){var a=function(){if("string"==typeof this.result&&""!==this.result){var a=this.result,b=/\[origins-to-destinations\]([^\[]+)/.exec(a);b&&2===b.length&&(a=b[1].trim().replace(/\|/g," ").replace(/\n/g," * noop\n"));var e={what:"setSessionRules",rules:f("#diff .right li")+"\n"+a};c.send("dashboard",e,d)}},b=this.files[0];if(void 0!==b&&""!==b.name&&0===b.type.indexOf("text")){var e=new FileReader;e.onload=a,e.readAsText(b)}}function b(){var a=vAPI.i18n("rulesDefaultFileName").replace("{{datetime}}",uBlockDashboard.dateNowToSensibleString()).replace(/ +/g,"_");vAPI.download({url:"data:text/plain,"+encodeURIComponent(f("#diff .left li")+"\n"),filename:a,saveAs:!0})}var c=vAPI.messaging,d=function(a){var b,c,d,e,f,g=uDom("#templates > ul > li"),h=uDom("#diff > .left ul").empty().remove(),i=uDom("#diff > .right ul").empty().remove();for(d=a.hnSwitches.split(/\n+/).sort(),f=0;f<d.length;f++)e=d[f],b=g.clone().text(e),c=g.clone().text(e),h.append(b),i.append(c);var j,k,l={},m={},n={};for(d=a.sessionRules.split(/\n+/),f=d.length;f--;)e=d[f].trim(),""!==e&&(n[e]=l[e]=!0);for(a.sessionRules=d.sort().join("\n"),d=a.permanentRules.split(/\n+/),f=d.length;f--;)e=d[f].trim(),""!==e&&(m[e]=l[e]=!0);for(a.permanentRules=d.sort().join("\n"),d=Object.keys(l).sort(),f=0;f<d.length;f++)e=d[f],j=m.hasOwnProperty(e),k=n.hasOwnProperty(e),b=g.clone(),c=g.clone(),j&&k?(b.text(e),c.text(e)):j?(b.text(e),c.text(e).addClass("notRight toRemove")):c.text(e).addClass("notLeft"),h.append(b),i.append(c);uDom("#diff > .left > .rulesContainer").append(h),uDom("#diff > .right > .rulesContainer").append(i),uDom("#diff").toggleClass("dirty",a.sessionRules!==a.permanentRules)},e=function(){var a=document.getElementById("importFilePicker");a.value="",a.click()},f=function(a){for(var b,c=[],d=uDom(a),e=0;e<d.length;e++)b=d.at(e),b.hasClassName("toRemove")?c.push(""):c.push(b.text());return c.join("\n").trim()},g=function(){var a={what:"setSessionRules",rules:f("#diff .left li")};c.send("dashboard",a,d)},h=function(){var a={what:"setPermanentRules",rules:f("#diff .right li")};c.send("dashboard",a,d)},i=function(){var a=uDom(this).ancestors("#diff");a.hasClassName("edit")||(uDom("#diff .right textarea").val(f("#diff .right li")),a.toggleClass("edit",!0))},j=function(){var a=uDom(this).ancestors("#diff");a.toggleClass("edit",!1);var b={what:"setSessionRules",rules:uDom("#diff .right textarea").val()};c.send("dashboard",b,d)},k=function(){var a=uDom(this).ancestors("#diff");a.toggleClass("edit",!1)},l=function(){return f("#diff .left li")},m=function(a,b){if("string"==typeof a){b&&(a=f("#diff .right li")+"\n"+a);var e={what:"setSessionRules",rules:a};c.send("dashboard",e,d)}};self.cloud.onPush=l,self.cloud.onPull=m,uDom("#importButton").on("click",e),uDom("#importFilePicker").on("change",a),uDom("#exportButton").on("click",b),uDom("#revertButton").on("click",g),uDom("#commitButton").on("click",h),uDom("#editEnterButton").on("click",i),uDom("#diff > .pane.right > .rulesContainer").on("dblclick",i),uDom("#editStopButton").on("click",j),uDom("#editCancelButton").on("click",k),c.send("dashboard",{what:"getRules"},d)}();