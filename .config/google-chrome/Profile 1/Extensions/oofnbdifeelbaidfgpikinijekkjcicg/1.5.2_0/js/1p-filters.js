!function(){"use strict";function a(a){"boolean"!=typeof a&&(a=uDom.nodeFromId("userFilters").value.trim()!==e),uDom.nodeFromId("userFiltersApply").disabled=!a,uDom.nodeFromId("userFiltersRevert").disabled=!a}function b(b){var c=function(c){if(!c.error){var d=uDom.nodeFromId("userFilters");if(e=c.content.trim(),d.value=c.content,b){d.value+="\n";var f=d.value.length;d.setSelectionRange(f,f),d.focus()}a(!1)}};d.send("dashboard",{what:"readUserFilters"},c)}function c(){d.send("dashboard",{what:"reloadAllFilters"}),uDom("#userFiltersApply").prop("disabled",!0)}var d=vAPI.messaging,e="",f=function(){var b=function(a){var b=/\n\[Subscription\]\n+url=~[^\n]+([\x08-\x7E]*?)(?:\[Subscription\]|$)/gi,c=/\[Subscription filters\]([\x08-\x7E]*?)(?:\[Subscription\]|$)/i,d=b.exec(a);if(null===d)return a;for(var e,f=[];null!==d;)2===d.length&&(e=c.exec(d[1].trim()),null!==e&&2===e.length&&f.push(e[1].trim().replace(/\\\[/g,"["))),d=b.exec(a);return f.join("\n")},c=function(){var c=b(this.result),d=uDom("#userFilters");d.val(d.val().trim()+"\n"+c),a()},d=this.files[0];if(void 0!==d&&""!==d.name&&0===d.type.indexOf("text")){var e=new FileReader;e.onload=c,e.readAsText(d)}},g=function(){var a=document.getElementById("importFilePicker");a.value="",a.click()},h=function(){var a=uDom("#userFilters").val().trim();if(""!==a){var b=vAPI.i18n("1pExportFilename").replace("{{datetime}}",uBlockDashboard.dateNowToSensibleString()).replace(/ +/g,"_");vAPI.download({url:"data:text/plain;charset=utf-8,"+encodeURIComponent(a+"\n"),filename:b})}},i=function(){var b=uDom.nodeFromId("userFilters"),f=function(d){d.error||(b.value=d.content,e=d.content.trim(),a(),c(),b.focus())},g={what:"writeUserFilters",content:b.value};d.send("dashboard",g,f)},j=function(){uDom.nodeFromId("userFilters").value=e+"\n",a()},k=function(){return uDom.nodeFromId("userFilters").value},l=function(b,c){if("string"==typeof b){var d=uDom.nodeFromId("userFilters");c&&(b=uBlockDashboard.mergeNewLines(d.value,b)),d.value=b,a()}};self.cloud.onPush=k,self.cloud.onPull=l,uDom("#importUserFiltersFromFile").on("click",g),uDom("#importFilePicker").on("change",f),uDom("#exportUserFiltersToFile").on("click",h),uDom("#userFilters").on("input",a),uDom("#userFiltersApply").on("click",i),uDom("#userFiltersRevert").on("click",j),b(!0)}();