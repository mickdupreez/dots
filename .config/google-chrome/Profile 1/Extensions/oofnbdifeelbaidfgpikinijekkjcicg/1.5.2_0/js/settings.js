!function(){"use strict";var a=vAPI.messaging,b=function(){var b=this.files[0];if(void 0!==b&&""!==b.name&&0===b.type.indexOf("text")){var c=b.name,d=function(){var b;try{if(b=JSON.parse(this.result),"object"!=typeof b)throw"Invalid";if("object"!=typeof b.userSettings)throw"Invalid";if("string"!=typeof b.netWhitelist)throw"Invalid";if("object"!=typeof b.filterLists&&Array.isArray(b.selectedFilterLists)===!1)throw"Invalid"}catch(d){b=void 0}if(void 0===b)return void window.alert(vAPI.i18n("aboutRestoreDataError"));var e=new Date(b.timeStamp),f=vAPI.i18n("aboutRestoreDataConfirm").replace("{{time}}",e.toLocaleString()),g=window.confirm(f);g&&a.send("dashboard",{what:"restoreUserData",userData:b,file:c})},e=new FileReader;e.onload=d,e.readAsText(b)}},c=function(){var a=document.getElementById("restoreFilePicker");a.value="",a.click()},d=function(){a.send("dashboard",{what:"backupUserData"},function(a){a instanceof Object!=!1&&a.userData instanceof Object!=!1&&(vAPI.download({url:"data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(a.userData,null,"  ")),filename:a.localData.lastBackupFile}),e(a.localData))})},e=function(a){uDom("#localData > ul > li:nth-of-type(1)").text(vAPI.i18n("settingsStorageUsed").replace("{{value}}","number"==typeof a.storageUsed?a.storageUsed.toLocaleString():"?"));var b,c,d={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"},e=a.lastBackupFile||"";""!==e&&(c=new Date(a.lastBackupTime),uDom("#localData > ul > li:nth-of-type(2) > ul > li:nth-of-type(1)").text(c.toLocaleString("fullwide",d)),uDom("#localData > ul > li:nth-of-type(2)").css("display",""));var f=a.lastRestoreFile||"";b=uDom("#localData > p:nth-of-type(3)"),""!==f&&(c=new Date(a.lastRestoreTime),uDom("#localData > ul > li:nth-of-type(3) > ul > li:nth-of-type(1)").text(c.toLocaleString("fullwide",d)),uDom("#localData > ul > li:nth-of-type(3) > ul > li:nth-of-type(2)").text(f),uDom("#localData > ul > li:nth-of-type(3)").css("display","")),a.cloudStorageSupported===!1&&uDom("#cloud-storage-enabled").attr("disabled",""),a.privacySettingsSupported===!1&&(uDom("#prefetching-disabled").attr("disabled",""),uDom("#hyperlink-auditing-disabled").attr("disabled",""),uDom("#webrtc-ipaddress-hidden").attr("disabled",""))},f=function(){var b=vAPI.i18n("aboutResetDataConfirm"),c=window.confirm(b);c&&a.send("dashboard",{what:"resetUserData"})},g=function(){document.body.classList.toggle("advancedUser",uDom.nodeFromId("advanced-user-enabled").checked===!0)},h=function(b,c){a.send("dashboard",{what:"userSettings",name:b,value:c})},i=function(a){var b=a.target,c=this.getAttribute("data-setting-name"),d=b.value;"largeMediaSize"===c&&(d=Math.min(Math.max(Math.floor(parseInt(d,10)||0),0),1e6)),d!==b.value&&(b.value=d),h(c,d)},j=function(a){a.target.focus(),a.preventDefault()},k=function(a){uDom('[data-setting-type="bool"]').forEach(function(b){b.prop("checked",a[b.attr("data-setting-name")]===!0).on("change",function(){h(this.getAttribute("data-setting-name"),this.checked),g()})}),uDom('[data-setting-name="noLargeMedia"] ~ label:first-of-type > input[type="number"]').attr("data-setting-name","largeMediaSize").attr("data-setting-type","input"),uDom('[data-setting-type="input"]').forEach(function(b){b.val(a[b.attr("data-setting-name")]).on("change",i).on("click",j)}),uDom("#export").on("click",d),uDom("#import").on("click",c),uDom("#reset").on("click",f),uDom("#restoreFilePicker").on("change",b),g()};uDom.onLoad(function(){a.send("dashboard",{what:"userSettings"},k),a.send("dashboard",{what:"getLocalData"},e)})}();