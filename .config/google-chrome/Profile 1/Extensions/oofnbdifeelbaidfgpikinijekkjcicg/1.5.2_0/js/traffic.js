"use strict";µBlock.webRequest=function(){var a={},b=null;µBlock.hiddenSettings.suspendTabsUntilReady?b=function(){var a=new Set;return µBlock.onStartCompletedQueue.push(function(c){b=null;for(var d,e=a.values();d=e.next(),!d.done;)vAPI.tabs.reload(d.value);c()}),function(b){return vAPI.isBehindTheSceneTabId(b)?void 0:(a.add(b),!0)}}():µBlock.onStartCompletedQueue.push(function(a){vAPI.onLoadAllCompleted(),a()});var c=function(a){var c=µBlock,e=a.tabId;if(null!==b&&b(e))return{cancel:!0};var g=a.type;if("main_frame"===g)return d(a);if("websocket"!==g){var h=µBlock.cspGet(a,2);if(void 0!==h)return h}if(vAPI.isBehindTheSceneTabId(e))return f(a);var i=c.pageStoreFromTabId(e);if(!i){var j=c.tabContextManager.mustLookup(e);if(vAPI.isBehindTheSceneTabId(j.tabId))return f(a);vAPI.tabs.onNavigation({tabId:e,frameId:0,url:j.rawURL}),i=c.pageStoreFromTabId(e)}var k="sub_frame"===g,l=i.createContextFromFrameId(k?a.parentFrameId:a.frameId),m=a.url;l.requestURL=m,l.requestHostname=c.URI.hostnameFromURI(m),l.requestType=g;var n=i.filterRequest(l);if(i.journalAddRequest(l.requestHostname,n),c.logger.isEnabled()&&c.logger.writeOne(e,"net",n,g,m,l.rootHostname,l.pageHostname),c.isAllowResult(n))return-1!==a.parentFrameId&&k&&i.setFrame(a.frameId,m),void l.dispose();if(c.hiddenSettings.ignoreRedirectFilters!==!0){var o=c.redirectEngine.toURL(l);if(void 0!==o)return i.internalRedirectionCount+=1,c.logger.isEnabled()&&c.logger.writeOne(e,"redirect","rr:"+c.redirectEngine.resourceNameRegister,g,m,l.rootHostname,l.pageHostname),l.dispose(),{redirectUrl:o}}return l.dispose(),{cancel:!0}},d=function(a){var b=a.tabId,c=a.url,d=µBlock,f=µBlock.cspGet(a,1);if(void 0!==f)return f;d.tabContextManager.push(b,c);var g=d.URI,h=g.hostnameFromURI(c),i=g.domainFromHostname(h)||h,j="",k={rootHostname:h,rootDomain:i,pageHostname:h,pageDomain:i,requestURL:c,requestHostname:h,requestType:"main_frame"};d.getNetFilteringSwitch(c)===!1&&(j="ua:whitelisted"),""===j&&d.hnSwitches.evaluateZ("no-strict-blocking",h)&&(j="ua:no-strict-blocking: "+d.hnSwitches.z+" true"),""===j&&(j=p(j,h),"a"===j.charAt(1)&&(j="ua:no-strict-blocking true (temporary)"));var l=d.staticNetFilteringEngine;""===j&&void 0!==l.matchStringExactType(k,c,"main_frame")&&(j=l.toResultString(!0)),""===j&&void 0!==l.matchStringExactType(k,c,"no_type")&&(j=l.toResultString(!0),"b"===j.charAt(1)&&(j=e(c,h,j)));var m=d.bindTabToPageStats(b,"beforeRequest");if(m&&(m.journalAddRootFrame("uncommitted",c),m.journalAddRequest(h,j)),d.logger.isEnabled()&&d.logger.writeOne(b,"net",j,"main_frame",c,h,h),!d.isAllowResult(j)){var n=j.slice(3),o=btoa(JSON.stringify({url:c,hn:h,dn:i,fc:n,fs:l.filterStringFromCompiled(n)}));return vAPI.tabs.replace(b,vAPI.getURL("document-blocked.html?details=")+o),{cancel:!0}}},e=function(a,b,c){var d=µBlock.staticNetFilteringEngine.filterRegexFromCompiled(c.slice(3),"gi");if(null===d)return"";var e=d.exec(a);return null===e?"":d.lastIndex<=a.indexOf(b)+b.length+1?c:""},f=function(a){var b=µBlock,c=b.pageStoreFromTabId(vAPI.noTabId);if(c){var d="",e=c.createContextFromPage(),f=a.type,g=a.url;if(e.requestURL=g,e.requestHostname=b.URI.hostnameFromURI(g),e.requestType=f,b.userSettings.advancedUserEnabled&&(d=c.filterRequestNoCache(e)),c.journalAddRequest(e.requestHostname,d),b.logger.isEnabled()&&b.logger.writeOne(vAPI.noTabId,"net",d,f,g,e.rootHostname,e.rootHostname),e.dispose(),!b.isAllowResult(d))return{cancel:!0}}},g=function(a){var b=µBlock.cspGet(a,3);return void 0!==b?b:void 0},h=function(a){var b=a.tabId;if(!vAPI.isBehindTheSceneTabId(b)){var c=µBlock.cspGet(a,4);if(void 0!==c)return c;var d=µBlock,e=a.type;"main_frame"===e&&d.tabContextManager.push(b,a.url);var f=d.pageStoreFromTabId(b);if(null===f){if("main_frame"!==e)return;f=d.bindTabToPageStats(b,"beforeRequest")}if(f.getNetFilteringSwitch()!==!1)return"image"===e||"media"===e?j(f,a):"script"===e||"main_frame"===e||"sub_frame"===e?i(f,a):void 0}},i=function(a,b){var c=µBlock,d=b.tabId,e=b.url,f=c.logger.isEnabled(),g=a.createContextFromPage();g.requestHostname=c.URI.hostnameFromURI(e),"main_frame"!==b.type&&(g.pageHostname=g.pageDomain=g.requestHostname);var h,i,j,l;"script"!==b.type&&(g.requestType="inline-script",g.requestURL=e,h=a.filterRequestNoCache(g),i=c.isBlockResult(h),g.requestType="script",g.requestURL="blob:",c.staticNetFilteringEngine.matchString(g),j=c.staticNetFilteringEngine.toResultString(f),l=c.isBlockResult(j)),c.staticNetFilteringEngine.matchStringExactType(g,e,"websocket");var m,n=c.staticNetFilteringEngine.toResultString(f),o=c.isBlockResult(n);return(i||o||l)&&(m=k(b.responseHeaders,i,o,l)),f&&"script"!==b.type&&(void 0!==i&&c.logger.writeOne(d,"net",h,"inline-script",e,g.rootHostname,g.pageHostname),n&&c.logger.writeOne(d,"net",n,"websocket",e,g.rootHostname,g.pageHostname),j&&c.logger.writeOne(d,"net",j,"worker",e,g.rootHostname,g.pageHostname)),g.dispose(),m===!0?(c.updateBadgeAsync(d),{responseHeaders:b.responseHeaders}):void 0},j=function(a,b){var c=µBlock,d=o("content-length",b.responseHeaders);if(-1!==d){var e=b.tabId,f=parseInt(b.responseHeaders[d].value,10)||0,g=a.filterLargeMediaElement(f);if(void 0!==g)return c.logger.isEnabled()&&c.logger.writeOne(e,"net",g,b.type,b.url,a.tabHostname,a.tabHostname),{cancel:!0}}},k=function(a,b,c,d){var e=k,f=o("content-security-policy",a),g=-1===f?"":a[f].value.trim(),h=g;b&&(h=l(h,e.reScriptSrc,"script-src 'unsafe-eval' *",e.reScriptSrcRemove)),c&&(h=l(h,e.reConnectSrc,"connect-src http:",e.reConnectSrcRemove)),d&&(h=l(h,e.reWorkerSrc,"child-src http:",e.reWorkerSrcRemove)),vAPI.chrome&&(b||c)&&(h=l(h,e.reFrameSrc,"frame-src http:",e.reFrameSrcRemove));var i=h!==g;return i&&(-1!==f&&a.splice(f,1),a.push({name:"Content-Security-Policy",value:h})),i};!function(){var a=k;a.reScriptSrc=/script-src[^;]*;?\s*/,a.reScriptSrcRemove=/'unsafe-inline'\s*|'nonce-[^']+'\s*/g,a.reConnectSrc=/connect-src[^;]*;?\s*/,a.reConnectSrcRemove=/wss?:[^\s]*\s*/g,a.reWorkerSrc=/child-src[^;]*;?\s*/,a.reWorkerSrcRemove=/blob:[^\s]*\s*/g,a.reFrameSrc=/frame-src[^;]*;?\s*/,a.reFrameSrcRemove=/data:[^\s]*\s*|blob:[^\s]*\s*/g}();var l=function(a,b,c,d){if(""===a)return c;var e=b.exec(a);if(null===e)return";"!==a.slice(-1)&&(a+=";"),a+=" "+c,a.replace(m,"");var f=e[0];return d.test(f)===!1?a:(a=a.replace(b,"").trim(),";"!==a.slice(-1)&&(a+=";"),f=f.replace(d,"").trim(),e=n.exec(f),e&&(f=e[1]+" 'none';"),a+=" "+f,a.replace(m,""))},m=/report-(?:to|uri)[^;]*;?\s*/,n=/^([a-z-]+)\s*;/,o=function(a,b){for(var c=b.length;c--;)if(b[c].name.toLowerCase()===a)return c;return-1};vAPI.net.onBeforeRequest={urls:["http://*/*","https://*/*"],extra:["blocking"],callback:c},vAPI.net.onBeforeSendHeader({urls:["http://*/*","https://*/*"],types:["main_frame","sub_frame","image","media","script"],extra:["blocking","requestHeaders"],callback:g}),vAPI.net.onHeadersReceived={urls:["http://*/*","https://*/*"],types:["main_frame","sub_frame","image","media","script"],extra:["blocking","responseHeaders"],callback:h},vAPI.net.registerListeners();var p=function(a,b){for(var c,d;;){if(c=q[b],void 0!==c)if(c>Date.now()){if(""===a)return"ua:* "+b+" doc allow"}else delete q[b];if(d=b.indexOf("."),-1===d)break;b=b.slice(d+1)}return a},q=Object.create(null);return a.temporarilyWhitelistDocument=function(a){"string"==typeof a&&""!==a&&(q[a]=Date.now()+6e4)},a}();