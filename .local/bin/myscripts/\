#!/bin/python3.8

import subprocess
import os
import time

# ASSUMED THAT THIS COMMAND HAS ALREADY BEEN RUN
# sudo mkdir /mnt/usb_stick

MOUNT_DIR = "/run/media/TimeShift"

def run_command(command):
    # start = time.time()
    ret_code, output = subprocess.getstatusoutput(command)
    if ret_code == 1:
        raise Exception("FAILED: %s" % command)
    # end = time.time()
    # print "Finished in %s seconds" % (end - start)
    return output.splitlines()


def uuid_from_line(line):
    start_str = "UUID=\""
    example_uuid = "c03207d9-6573-46ff-bb14-7f96b3bd943c"
    uuid_start = line.index(start_str) + len(start_str)
    uuid_end = uuid_start + len(example_uuid)
    return line[uuid_start: uuid_end]

output = subprocess.run("blkid | grep LABEL | grep -v boot")
# ['/dev/sda1: LABEL="KINGSTON" UUID="6784-3407" TYPE="vfat" PARTUUID="459720e1-01"']
for usb_device in output:
    command = "mount --uuid %s %s" % (uuid_from_line(usb_device), MOUNT_DIR)
    run_command(command)
    break



